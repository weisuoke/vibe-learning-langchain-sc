# å¼‚å¸¸å¤„ç†æœºåˆ¶

> åŸå­åŒ–çŸ¥è¯†ç‚¹ | PythonåŸºç¡€ | LangChain æºç å­¦ä¹ å‰ç½®çŸ¥è¯†

---

## 1. ã€30å­—æ ¸å¿ƒã€‘

**å¼‚å¸¸å¤„ç†æ˜¯ Python æ•è·å’Œå“åº”è¿è¡Œæ—¶é”™è¯¯çš„æœºåˆ¶ï¼Œé€šè¿‡ try-except å®ç°ç¨‹åºå¥å£®æ€§ï¼Œæ˜¯ LangChain ä¸­ API è°ƒç”¨ã€æ•°æ®è§£æçš„å¯é ä¿éšœã€‚**

---

## 2. ã€ç¬¬ä¸€æ€§åŸç†ã€‘

### ä»€ä¹ˆæ˜¯ç¬¬ä¸€æ€§åŸç†ï¼Ÿ

**ç¬¬ä¸€æ€§åŸç†**ï¼šå›åˆ°äº‹ç‰©æœ€åŸºæœ¬çš„çœŸç†ï¼Œä»æºå¤´æ€è€ƒé—®é¢˜

### å¼‚å¸¸å¤„ç†çš„ç¬¬ä¸€æ€§åŸç† ğŸ¯

#### 1. æœ€åŸºç¡€çš„å®šä¹‰

**å¼‚å¸¸ = ç¨‹åºè¿è¡Œæ—¶çš„"æ„å¤–äº‹ä»¶"**

ä»…æ­¤è€Œå·²ï¼æ²¡æœ‰æ›´åŸºç¡€çš„äº†ã€‚

- **å¼‚å¸¸**ï¼šç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„éæ­£å¸¸æƒ…å†µ
- **å¤„ç†**ï¼šå¯¹è¿™äº›éæ­£å¸¸æƒ…å†µçš„å“åº”å’Œæ¢å¤
- **æœºåˆ¶**ï¼šPython æä¾›çš„ä¸€å¥—è¯­æ³•å’Œå·¥å…·

```python
# ä»€ä¹ˆæ˜¯"æ„å¤–äº‹ä»¶"ï¼Ÿ
result = 10 / 0        # é™¤ä»¥é›¶ â†’ ZeroDivisionError
name = user["name"]    # é”®ä¸å­˜åœ¨ â†’ KeyError
file = open("x.txt")   # æ–‡ä»¶ä¸å­˜åœ¨ â†’ FileNotFoundError
response = api.call()  # ç½‘ç»œè¶…æ—¶ â†’ TimeoutError
```

#### 2. ä¸ºä»€ä¹ˆéœ€è¦å¼‚å¸¸å¤„ç†ï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šç¨‹åºé‡åˆ°é”™è¯¯æ—¶ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ**

```python
# æ²¡æœ‰å¼‚å¸¸å¤„ç†çš„ä¸–ç•Œ
def get_llm_response(prompt):
    response = api.call(prompt)  # å¦‚æœ API è¶…æ—¶å‘¢ï¼Ÿ
    data = json.loads(response)  # å¦‚æœè¿”å›çš„ä¸æ˜¯ JSON å‘¢ï¼Ÿ
    return data["result"]        # å¦‚æœæ²¡æœ‰ result å­—æ®µå‘¢ï¼Ÿ

# ä»»ä½•ä¸€æ­¥å‡ºé”™ï¼Œç¨‹åºå°±å´©æºƒäº†ï¼
# ç”¨æˆ·çœ‹åˆ°çš„æ˜¯ä»¤äººå›°æƒ‘çš„é”™è¯¯å †æ ˆ
```

```python
# æœ‰å¼‚å¸¸å¤„ç†çš„ä¸–ç•Œ
def get_llm_response(prompt):
    try:
        response = api.call(prompt)
        data = json.loads(response)
        return data["result"]
    except TimeoutError:
        return "æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•"
    except json.JSONDecodeError:
        return "å“åº”æ ¼å¼é”™è¯¯"
    except KeyError:
        return "å“åº”ç¼ºå°‘å¿…è¦å­—æ®µ"

# ç¨‹åºä¸ä¼šå´©æºƒï¼Œç”¨æˆ·å¾—åˆ°å‹å¥½æç¤º
# é”™è¯¯å¯ä»¥è¢«è®°å½•ã€åˆ†æã€ä¸ŠæŠ¥
```

#### 3. å¼‚å¸¸å¤„ç†çš„ä¸‰å±‚ä»·å€¼

##### ä»·å€¼1ï¼šç¨‹åºå¥å£®æ€§ - ä¸å´©æºƒ

```python
# LangChain ä¸­çš„ä¾‹å­ï¼šè°ƒç”¨ LLM API
from langchain_openai import ChatOpenAI

llm = ChatOpenAI()
try:
    response = llm.invoke("Hello")
except Exception as e:
    # API æŒ‚äº†ï¼Ÿç½‘ç»œæ–­äº†ï¼Ÿé…é¢ç”¨å®Œäº†ï¼Ÿ
    # ç¨‹åºä¸ä¼šå´©æºƒï¼Œå¯ä»¥ä¼˜é›…é™çº§
    response = fallback_response()
```

##### ä»·å€¼2ï¼šé”™è¯¯ä¼ é€’ - å‘ä¸ŠæŠ¥å‘Š

```python
# å¼‚å¸¸å¯ä»¥è·¨è¶Šå¤šå±‚è°ƒç”¨å‘ä¸Šä¼ é€’
def layer_1():
    layer_2()

def layer_2():
    layer_3()

def layer_3():
    raise ValueError("åº•å±‚å‡ºé”™äº†")

try:
    layer_1()  # é”™è¯¯ä¼šä» layer_3 ä¸€è·¯ä¼ é€’ä¸Šæ¥
except ValueError as e:
    print(f"æ•è·åˆ°åº•å±‚é”™è¯¯: {e}")
```

##### ä»·å€¼3ï¼šä¿¡æ¯ä¿ç•™ - è°ƒè¯•å‹å¥½

```python
# å¼‚å¸¸æºå¸¦ä¸°å¯Œçš„è°ƒè¯•ä¿¡æ¯
try:
    result = risky_operation()
except Exception as e:
    print(f"é”™è¯¯ç±»å‹: {type(e).__name__}")  # ValueError
    print(f"é”™è¯¯ä¿¡æ¯: {e}")                  # å…·ä½“æè¿°
    print(f"è°ƒç”¨æ ˆ: {e.__traceback__}")     # å“ªé‡Œå‡ºé”™çš„
```

#### 4. ä»ç¬¬ä¸€æ€§åŸç†æ¨å¯¼ LangChain æºç åº”ç”¨

**æ¨ç†é“¾ï¼š**

```
1. LLM åº”ç”¨éœ€è¦è°ƒç”¨å¤–éƒ¨ APIï¼ˆOpenAIã€Anthropic...ï¼‰
   â†“
2. å¤–éƒ¨è°ƒç”¨å¯èƒ½å¤±è´¥ï¼ˆç½‘ç»œé—®é¢˜ã€é…é¢é™åˆ¶ã€æ ¼å¼é”™è¯¯...ï¼‰
   â†“
3. éœ€è¦ä¸€ç§æ–¹å¼ä¼˜é›…åœ°å¤„ç†è¿™äº›å¤±è´¥
   â†“
4. Python çš„å¼‚å¸¸æœºåˆ¶å®Œç¾åŒ¹é…è¿™ä¸ªéœ€æ±‚
   â†“
5. å®šä¹‰ç‰¹å®šå¼‚å¸¸ç±»å‹ï¼ˆOutputParserExceptionã€LLMException...ï¼‰
   â†“
6. åœ¨å…³é”®ä½ç½®æ•è·å’Œå¤„ç†å¼‚å¸¸
   â†“
7. æä¾›é‡è¯•æœºåˆ¶ï¼ˆwith_retryï¼‰å’Œé™çº§ç­–ç•¥ï¼ˆfallbackï¼‰
   â†“
8. LangChain çš„ Runnable åè®®å†…ç½®äº†é”™è¯¯å¤„ç†æ”¯æŒ
```

#### 5. ä¸€å¥è¯æ€»ç»“ç¬¬ä¸€æ€§åŸç†

**å¼‚å¸¸æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„"æ„å¤–äº‹ä»¶"ï¼Œå¼‚å¸¸å¤„ç†è®©ç¨‹åºèƒ½å¤Ÿä¼˜é›…åœ°å“åº”è¿™äº›æ„å¤–ï¼Œæ˜¯æ„å»ºå¥å£® LLM åº”ç”¨çš„åŸºç¡€ã€‚**

---

## 3. ã€æ ¸å¿ƒæ¦‚å¿µï¼ˆå…¨é¢è¦†ç›–ï¼‰ã€‘

### æ ¸å¿ƒæ¦‚å¿µ1ï¼štry-except-else-finally å®Œæ•´ç»“æ„ ğŸ—ï¸

**Python å¼‚å¸¸å¤„ç†çš„å®Œæ•´è¯­æ³•ç»“æ„**

```python
try:
    # å¯èƒ½å‡ºé”™çš„ä»£ç 
    result = risky_operation()
except SpecificError as e:
    # æ•è·ç‰¹å®šç±»å‹çš„å¼‚å¸¸
    handle_specific_error(e)
except AnotherError as e:
    # æ•è·å¦ä¸€ç§ç±»å‹çš„å¼‚å¸¸
    handle_another_error(e)
except Exception as e:
    # æ•è·æ‰€æœ‰å…¶ä»–å¼‚å¸¸ï¼ˆå…œåº•ï¼‰
    handle_general_error(e)
else:
    # å¦‚æœæ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œæ‰§è¡Œè¿™é‡Œ
    process_result(result)
finally:
    # æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œ
    cleanup()
```

**å„éƒ¨åˆ†çš„ä½œç”¨ï¼š**

| å…³é”®å­— | ä½œç”¨ | æ˜¯å¦å¿…é¡» | æ‰§è¡Œæ¡ä»¶ |
|-------|------|---------|---------|
| `try` | åŒ…è£¹å¯èƒ½å‡ºé”™çš„ä»£ç  | âœ… å¿…é¡» | æ€»æ˜¯æ‰§è¡Œ |
| `except` | æ•è·å’Œå¤„ç†å¼‚å¸¸ | âœ… è‡³å°‘ä¸€ä¸ª | å‘ç”Ÿå¼‚å¸¸æ—¶ |
| `else` | æ— å¼‚å¸¸æ—¶æ‰§è¡Œ | âŒ å¯é€‰ | æ²¡æœ‰å¼‚å¸¸æ—¶ |
| `finally` | æ¸…ç†èµ„æº | âŒ å¯é€‰ | æ€»æ˜¯æ‰§è¡Œ |

**è¯¦ç»†ç¤ºä¾‹ï¼š**

```python
def read_config(filename: str) -> dict:
    """è¯»å–é…ç½®æ–‡ä»¶ - å±•ç¤ºå®Œæ•´çš„å¼‚å¸¸å¤„ç†ç»“æ„"""
    file = None
    try:
        # å¯èƒ½å‡ºé”™ï¼šæ–‡ä»¶ä¸å­˜åœ¨ã€æƒé™é—®é¢˜
        file = open(filename, 'r')
        # å¯èƒ½å‡ºé”™ï¼šä¸æ˜¯æœ‰æ•ˆçš„ JSON
        config = json.load(file)
        # å¯èƒ½å‡ºé”™ï¼šç¼ºå°‘å¿…è¦å­—æ®µ
        api_key = config["api_key"]

    except FileNotFoundError:
        print(f"é…ç½®æ–‡ä»¶ {filename} ä¸å­˜åœ¨")
        return {"api_key": "default"}

    except json.JSONDecodeError as e:
        print(f"é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯: {e}")
        return {"api_key": "default"}

    except KeyError as e:
        print(f"é…ç½®ç¼ºå°‘å¿…è¦å­—æ®µ: {e}")
        return {"api_key": "default"}

    else:
        # ä¸€åˆ‡æ­£å¸¸ï¼Œæ‰“å°æˆåŠŸä¿¡æ¯
        print(f"æˆåŠŸåŠ è½½é…ç½®: {filename}")
        return config

    finally:
        # æ— è®ºå¦‚ä½•éƒ½è¦å…³é—­æ–‡ä»¶
        if file:
            file.close()
            print("æ–‡ä»¶å·²å…³é—­")

# æµ‹è¯•
config = read_config("config.json")
```

**åœ¨ LangChain æºç ä¸­çš„åº”ç”¨ï¼š**

```python
# langchain_core/output_parsers/base.py ç®€åŒ–ç‰ˆ
class BaseOutputParser:
    def parse(self, text: str):
        try:
            return self._parse(text)
        except Exception as e:
            # æ•è·è§£æé”™è¯¯ï¼ŒåŒ…è£…æˆç‰¹å®šå¼‚å¸¸
            raise OutputParserException(f"è§£æå¤±è´¥: {e}") from e

    def parse_with_retry(self, text: str, max_retries: int = 3):
        for attempt in range(max_retries):
            try:
                return self.parse(text)
            except OutputParserException as e:
                if attempt == max_retries - 1:
                    raise  # æœ€åä¸€æ¬¡é‡è¯•å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸
                continue  # ç»§ç»­é‡è¯•
```

---

### æ ¸å¿ƒæ¦‚å¿µ2ï¼šå¼‚å¸¸å±‚æ¬¡ç»“æ„ ğŸ“Š

**Python å¼‚å¸¸æ˜¯ä¸€ä¸ªç±»å±‚æ¬¡ç»“æ„ï¼Œæ‰€æœ‰å¼‚å¸¸éƒ½ç»§æ‰¿è‡ª BaseException**

```
BaseException
â”œâ”€â”€ SystemExit              # sys.exit() è§¦å‘
â”œâ”€â”€ KeyboardInterrupt       # Ctrl+C è§¦å‘
â”œâ”€â”€ GeneratorExit           # ç”Ÿæˆå™¨å…³é—­
â””â”€â”€ Exception               # æ‰€æœ‰"å¸¸è§„"å¼‚å¸¸çš„åŸºç±»
    â”œâ”€â”€ StopIteration       # è¿­ä»£ç»“æŸ
    â”œâ”€â”€ ArithmeticError     # ç®—æœ¯é”™è¯¯
    â”‚   â”œâ”€â”€ ZeroDivisionError
    â”‚   â””â”€â”€ OverflowError
    â”œâ”€â”€ LookupError         # æŸ¥æ‰¾é”™è¯¯
    â”‚   â”œâ”€â”€ KeyError
    â”‚   â””â”€â”€ IndexError
    â”œâ”€â”€ ValueError          # å€¼é”™è¯¯
    â”œâ”€â”€ TypeError           # ç±»å‹é”™è¯¯
    â”œâ”€â”€ AttributeError      # å±æ€§é”™è¯¯
    â”œâ”€â”€ OSError             # ç³»ç»Ÿé”™è¯¯
    â”‚   â”œâ”€â”€ FileNotFoundError
    â”‚   â”œâ”€â”€ PermissionError
    â”‚   â””â”€â”€ TimeoutError
    â””â”€â”€ RuntimeError        # è¿è¡Œæ—¶é”™è¯¯
```

**ä¸ºä»€ä¹ˆå±‚æ¬¡ç»“æ„å¾ˆé‡è¦ï¼Ÿ**

```python
# å¯ä»¥æ•è·ä¸€ç±»å¼‚å¸¸
try:
    value = my_dict["key"]      # å¯èƒ½ KeyError
    item = my_list[10]          # å¯èƒ½ IndexError
except LookupError as e:
    # åŒæ—¶æ•è· KeyError å’Œ IndexError
    print(f"æŸ¥æ‰¾å¤±è´¥: {e}")

# å¯ä»¥ç²¾ç¡®æ•è·ç‰¹å®šå¼‚å¸¸
try:
    result = 10 / x
except ZeroDivisionError:
    print("é™¤æ•°ä¸èƒ½ä¸ºé›¶")
except ArithmeticError:
    print("å…¶ä»–ç®—æœ¯é”™è¯¯")
```

**æ•è·é¡ºåºå¾ˆé‡è¦ï¼š**

```python
# âŒ é”™è¯¯é¡ºåºï¼šå­ç±»å¼‚å¸¸æ°¸è¿œä¸ä¼šè¢«æ•è·
try:
    risky_operation()
except Exception:  # å¤ªå®½æ³›ï¼Œæ•è·æ‰€æœ‰
    print("é€šç”¨é”™è¯¯")
except ValueError:  # æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼
    print("å€¼é”™è¯¯")

# âœ… æ­£ç¡®é¡ºåºï¼šå…ˆæ•è·å…·ä½“çš„ï¼Œå†æ•è·é€šç”¨çš„
try:
    risky_operation()
except ValueError:  # å…ˆæ•è·å…·ä½“çš„
    print("å€¼é”™è¯¯")
except Exception:   # å†æ•è·é€šç”¨çš„
    print("å…¶ä»–é”™è¯¯")
```

**å¸¸ç”¨å¼‚å¸¸é€ŸæŸ¥è¡¨ï¼š**

| å¼‚å¸¸ç±»å‹ | è§¦å‘åœºæ™¯ | ç¤ºä¾‹ |
|---------|---------|------|
| `ValueError` | å€¼ä¸åˆæ³• | `int("abc")` |
| `TypeError` | ç±»å‹ä¸å¯¹ | `"a" + 1` |
| `KeyError` | å­—å…¸é”®ä¸å­˜åœ¨ | `d["missing"]` |
| `IndexError` | åˆ—è¡¨ç´¢å¼•è¶Šç•Œ | `[1,2,3][10]` |
| `AttributeError` | å±æ€§ä¸å­˜åœ¨ | `obj.missing_attr` |
| `FileNotFoundError` | æ–‡ä»¶ä¸å­˜åœ¨ | `open("x.txt")` |
| `TimeoutError` | æ“ä½œè¶…æ—¶ | ç½‘ç»œè¯·æ±‚è¶…æ—¶ |
| `ConnectionError` | è¿æ¥å¤±è´¥ | API è¿æ¥å¤±è´¥ |
| `JSONDecodeError` | JSON è§£æå¤±è´¥ | `json.loads("{")` |

**åœ¨ LangChain æºç ä¸­çš„åº”ç”¨ï¼š**

```python
# LangChain å®šä¹‰äº†è‡ªå·±çš„å¼‚å¸¸å±‚æ¬¡ç»“æ„
# langchain_core/exceptions.py

class LangChainException(Exception):
    """LangChain æ‰€æœ‰å¼‚å¸¸çš„åŸºç±»"""
    pass

class OutputParserException(LangChainException):
    """è¾“å‡ºè§£æå¼‚å¸¸"""
    pass

class LLMException(LangChainException):
    """LLM è°ƒç”¨å¼‚å¸¸"""
    pass

# ä½¿ç”¨æ—¶å¯ä»¥ç²¾ç¡®æ•è·
try:
    result = chain.invoke(input)
except OutputParserException:
    # å¤„ç†è§£æé”™è¯¯
    pass
except LLMException:
    # å¤„ç† LLM è°ƒç”¨é”™è¯¯
    pass
except LangChainException:
    # å¤„ç†å…¶ä»– LangChain é”™è¯¯
    pass
```

---

### æ ¸å¿ƒæ¦‚å¿µ3ï¼šè‡ªå®šä¹‰å¼‚å¸¸ ğŸ”§

**åˆ›å»ºé¡¹ç›®ç‰¹å®šçš„å¼‚å¸¸ç±»ï¼Œæä¾›æ›´ç²¾ç¡®çš„é”™è¯¯ä¿¡æ¯**

```python
class MyProjectError(Exception):
    """é¡¹ç›®å¼‚å¸¸åŸºç±»"""
    pass

class ConfigurationError(MyProjectError):
    """é…ç½®é”™è¯¯"""
    def __init__(self, key: str, message: str):
        self.key = key
        super().__init__(f"é…ç½®é”™è¯¯ [{key}]: {message}")

class APIError(MyProjectError):
    """API è°ƒç”¨é”™è¯¯"""
    def __init__(self, status_code: int, message: str):
        self.status_code = status_code
        super().__init__(f"API é”™è¯¯ [{status_code}]: {message}")

class ValidationError(MyProjectError):
    """æ•°æ®éªŒè¯é”™è¯¯"""
    def __init__(self, field: str, value, reason: str):
        self.field = field
        self.value = value
        self.reason = reason
        super().__init__(f"éªŒè¯å¤±è´¥ - {field}={value}: {reason}")

# ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸
def validate_temperature(temp: float) -> float:
    if not 0 <= temp <= 2:
        raise ValidationError(
            field="temperature",
            value=temp,
            reason="å¿…é¡»åœ¨ 0 åˆ° 2 ä¹‹é—´"
        )
    return temp

try:
    validate_temperature(3.0)
except ValidationError as e:
    print(f"å­—æ®µ: {e.field}")
    print(f"å€¼: {e.value}")
    print(f"åŸå› : {e.reason}")
```

**è‡ªå®šä¹‰å¼‚å¸¸çš„æœ€ä½³å®è·µï¼š**

```python
from typing import Optional, Any
from dataclasses import dataclass

@dataclass
class ErrorContext:
    """é”™è¯¯ä¸Šä¸‹æ–‡ä¿¡æ¯"""
    operation: str
    input_data: Any
    timestamp: float

class LLMApplicationError(Exception):
    """LLM åº”ç”¨å¼‚å¸¸åŸºç±»"""

    def __init__(
        self,
        message: str,
        context: Optional[ErrorContext] = None,
        recoverable: bool = True
    ):
        super().__init__(message)
        self.context = context
        self.recoverable = recoverable

    def __str__(self):
        base = super().__str__()
        if self.context:
            return f"{base} (æ“ä½œ: {self.context.operation})"
        return base

class TokenLimitExceeded(LLMApplicationError):
    """Token è¶…é™"""
    def __init__(self, used: int, limit: int):
        self.used = used
        self.limit = limit
        super().__init__(
            f"Token è¶…é™: ä½¿ç”¨ {used}/{limit}",
            recoverable=True  # å¯ä»¥é€šè¿‡æˆªæ–­è¾“å…¥æ¢å¤
        )

class RateLimitError(LLMApplicationError):
    """é€Ÿç‡é™åˆ¶"""
    def __init__(self, retry_after: float):
        self.retry_after = retry_after
        super().__init__(
            f"é€Ÿç‡é™åˆ¶ï¼Œ{retry_after} ç§’åé‡è¯•",
            recoverable=True
        )

class ModelNotFoundError(LLMApplicationError):
    """æ¨¡å‹ä¸å­˜åœ¨"""
    def __init__(self, model_name: str):
        self.model_name = model_name
        super().__init__(
            f"æ¨¡å‹ {model_name} ä¸å­˜åœ¨",
            recoverable=False  # ä¸å¯æ¢å¤
        )
```

**åœ¨ LangChain æºç ä¸­çš„åº”ç”¨ï¼š**

```python
# langchain_core/output_parsers/base.py
class OutputParserException(Exception):
    """è¾“å‡ºè§£æå¼‚å¸¸ - LangChain çš„è‡ªå®šä¹‰å¼‚å¸¸"""

    def __init__(
        self,
        error: str,
        observation: Optional[str] = None,
        llm_output: Optional[str] = None,
        send_to_llm: bool = False,
    ):
        super().__init__(error)
        self.observation = observation
        self.llm_output = llm_output
        self.send_to_llm = send_to_llm

# ä½¿ç”¨
try:
    result = parser.parse(llm_output)
except OutputParserException as e:
    if e.send_to_llm:
        # å¯ä»¥æŠŠé”™è¯¯ä¿¡æ¯å‘é€ç»™ LLM è®©å®ƒé‡æ–°ç”Ÿæˆ
        corrected = llm.invoke(f"ä½ çš„è¾“å‡ºæ ¼å¼æœ‰è¯¯: {e.observation}")
```

---

### æ‰©å±•æ¦‚å¿µ4ï¼šå¼‚å¸¸é“¾ (Exception Chaining) ğŸ”—

**ä½¿ç”¨ `raise ... from ...` ä¿ç•™åŸå§‹å¼‚å¸¸ä¿¡æ¯**

```python
# âŒ ä¸å¥½çš„åšæ³•ï¼šä¸¢å¤±åŸå§‹å¼‚å¸¸ä¿¡æ¯
def process_data(data):
    try:
        return json.loads(data)
    except json.JSONDecodeError:
        raise ValueError("æ•°æ®æ ¼å¼é”™è¯¯")  # åŸå§‹é”™è¯¯ä¿¡æ¯ä¸¢å¤±äº†

# âœ… å¥½çš„åšæ³•ï¼šä¿ç•™å¼‚å¸¸é“¾
def process_data(data):
    try:
        return json.loads(data)
    except json.JSONDecodeError as e:
        raise ValueError("æ•°æ®æ ¼å¼é”™è¯¯") from e  # ä¿ç•™åŸå§‹å¼‚å¸¸

# æ•ˆæœå¯¹æ¯”
try:
    process_data("{invalid}")
except ValueError as e:
    print(f"é”™è¯¯: {e}")
    print(f"åŸå› : {e.__cause__}")  # å¯ä»¥è®¿é—®åŸå§‹å¼‚å¸¸
```

**å¼‚å¸¸é“¾çš„è¾“å‡ºï¼š**

```
Traceback (most recent call last):
  File "...", line 3, in process_data
    return json.loads(data)
json.decoder.JSONDecodeError: Expecting property name: line 1 column 2 (char 1)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "...", line 10, in <module>
    process_data("{invalid}")
ValueError: æ•°æ®æ ¼å¼é”™è¯¯
```

**ä¸‰ç§å¼‚å¸¸é“¾åœºæ™¯ï¼š**

```python
# 1. æ˜¾å¼é“¾æ¥ï¼šraise ... from e
try:
    data = json.loads(text)
except json.JSONDecodeError as e:
    raise ParseError("JSON è§£æå¤±è´¥") from e

# 2. éšå¼é“¾æ¥ï¼šåœ¨ except ä¸­ raise æ–°å¼‚å¸¸
try:
    data = json.loads(text)
except json.JSONDecodeError:
    raise ParseError("JSON è§£æå¤±è´¥")  # __context__ è‡ªåŠ¨è®¾ç½®

# 3. æ˜ç¡®æ–­å¼€é“¾æ¥ï¼šraise ... from None
try:
    data = json.loads(text)
except json.JSONDecodeError:
    raise ParseError("JSON è§£æå¤±è´¥") from None  # ä¸æ˜¾ç¤ºåŸå§‹å¼‚å¸¸
```

**åœ¨ LangChain æºç ä¸­çš„åº”ç”¨ï¼š**

```python
# langchain_core/runnables/base.py
class Runnable:
    def invoke(self, input):
        try:
            return self._invoke(input)
        except Exception as e:
            # åŒ…è£…å¼‚å¸¸ï¼Œä¿ç•™åŸå§‹ä¿¡æ¯
            raise RuntimeError(
                f"Runnable {self.name} è°ƒç”¨å¤±è´¥"
            ) from e
```

---

### æ‰©å±•æ¦‚å¿µ5ï¼šä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸å¼‚å¸¸ ğŸ“¦

**`with` è¯­å¥è‡ªåŠ¨å¤„ç†èµ„æºæ¸…ç†ï¼Œå³ä½¿å‘ç”Ÿå¼‚å¸¸**

```python
# with è¯­å¥çš„å¼‚å¸¸å¤„ç†
with open("file.txt") as f:
    content = f.read()
    # å³ä½¿è¿™é‡Œå‘ç”Ÿå¼‚å¸¸ï¼Œæ–‡ä»¶ä¹Ÿä¼šè¢«æ­£ç¡®å…³é—­

# ç­‰ä»·äº
f = open("file.txt")
try:
    content = f.read()
finally:
    f.close()
```

**åˆ›å»ºè‡ªå®šä¹‰ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼š**

```python
from contextlib import contextmanager
from typing import Generator

# æ–¹å¼1ï¼šä½¿ç”¨ç±»
class DatabaseConnection:
    """æ•°æ®åº“è¿æ¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""

    def __init__(self, host: str):
        self.host = host
        self.connection = None

    def __enter__(self):
        """è¿›å…¥ä¸Šä¸‹æ–‡æ—¶è°ƒç”¨"""
        print(f"è¿æ¥åˆ° {self.host}")
        self.connection = f"Connection to {self.host}"
        return self.connection

    def __exit__(self, exc_type, exc_val, exc_tb):
        """é€€å‡ºä¸Šä¸‹æ–‡æ—¶è°ƒç”¨ï¼Œå³ä½¿æœ‰å¼‚å¸¸"""
        print("å…³é—­è¿æ¥")
        self.connection = None
        # è¿”å› False è¡¨ç¤ºä¸æŠ‘åˆ¶å¼‚å¸¸
        # è¿”å› True è¡¨ç¤ºæŠ‘åˆ¶å¼‚å¸¸ï¼ˆä¸æ¨èï¼‰
        return False

with DatabaseConnection("localhost") as conn:
    print(f"ä½¿ç”¨è¿æ¥: {conn}")
    # å³ä½¿è¿™é‡Œå‡ºé”™ï¼Œ__exit__ ä¹Ÿä¼šè¢«è°ƒç”¨
```

```python
# æ–¹å¼2ï¼šä½¿ç”¨ @contextmanager è£…é¥°å™¨
@contextmanager
def timer(name: str) -> Generator[None, None, None]:
    """è®¡æ—¶ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
    import time
    start = time.time()
    print(f"å¼€å§‹ {name}")
    try:
        yield  # è¿™é‡Œæ˜¯ with å—çš„ä»£ç æ‰§è¡Œç‚¹
    except Exception as e:
        print(f"{name} å‡ºé”™: {e}")
        raise  # é‡æ–°æŠ›å‡ºå¼‚å¸¸
    finally:
        elapsed = time.time() - start
        print(f"{name} å®Œæˆï¼Œè€—æ—¶ {elapsed:.2f}s")

with timer("æ•°æ®å¤„ç†"):
    # ä½ çš„ä»£ç 
    data = process_large_data()
```

**åœ¨ LangChain æºç ä¸­çš„åº”ç”¨ï¼š**

```python
# å›è°ƒç®¡ç†å™¨ä¸Šä¸‹æ–‡
from langchain_core.callbacks import CallbackManager

@contextmanager
def trace_execution(run_name: str):
    """è¿½è¸ªæ‰§è¡Œä¸Šä¸‹æ–‡"""
    callback_manager = CallbackManager()
    run_id = callback_manager.on_chain_start(run_name)
    try:
        yield callback_manager
        callback_manager.on_chain_end(run_id)
    except Exception as e:
        callback_manager.on_chain_error(run_id, e)
        raise

with trace_execution("my_chain") as callbacks:
    result = chain.invoke(input, callbacks=callbacks)
```

---

## 4. ã€æœ€å°å¯ç”¨ã€‘

æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½å¼€å§‹è¿›è¡Œ LangChain æºç é˜…è¯»ï¼š

### 4.1 åŸºç¡€ try-except

```python
try:
    result = risky_operation()
except Exception as e:
    print(f"å‡ºé”™äº†: {e}")
    result = default_value
```

### 4.2 æ•è·ç‰¹å®šå¼‚å¸¸

```python
try:
    data = json.loads(text)
except json.JSONDecodeError:
    data = {}
except FileNotFoundError:
    data = {}
```

### 4.3 raise æŠ›å‡ºå¼‚å¸¸

```python
def validate(value):
    if value < 0:
        raise ValueError(f"å€¼ä¸èƒ½ä¸ºè´Ÿ: {value}")
    return value

# é‡æ–°æŠ›å‡ºå½“å‰å¼‚å¸¸
try:
    do_something()
except Exception:
    log_error()
    raise  # ä¸å¸¦å‚æ•°ï¼Œé‡æ–°æŠ›å‡ºå½“å‰å¼‚å¸¸
```

### 4.4 finally æ¸…ç†èµ„æº

```python
file = None
try:
    file = open("data.txt")
    process(file)
finally:
    if file:
        file.close()  # æ— è®ºæ˜¯å¦å‡ºé”™éƒ½ä¼šæ‰§è¡Œ
```

### 4.5 with è¯­å¥ï¼ˆæ¨èï¼‰

```python
# è‡ªåŠ¨å¤„ç†èµ„æºæ¸…ç†
with open("data.txt") as file:
    process(file)
# æ–‡ä»¶è‡ªåŠ¨å…³é—­ï¼Œå³ä½¿å‡ºé”™
```

**è¿™äº›çŸ¥è¯†è¶³ä»¥ï¼š**
- é˜…è¯» LangChain æºç ä¸­çš„å¼‚å¸¸å¤„ç†é€»è¾‘
- ç†è§£ `OutputParserException`ã€`LLMException` ç­‰è‡ªå®šä¹‰å¼‚å¸¸
- åœ¨è‡ªå·±çš„ LLM åº”ç”¨ä¸­å¤„ç† API é”™è¯¯
- å®ç°å¥å£®çš„æ•°æ®è§£æå’ŒéªŒè¯

---

## 5. ã€1ä¸ªç±»æ¯”ã€‘ï¼ˆåŒè½¨åˆ¶ï¼‰

### ç±»æ¯”1ï¼štry-except ç»“æ„

#### ğŸ¨ å‰ç«¯è§†è§’ï¼štry-catch / Promise.catch

å¼‚å¸¸å¤„ç†å°±åƒ JavaScript çš„ try-catch æˆ– Promise çš„ .catch()ã€‚

```javascript
// JavaScript: try-catch
try {
    const data = JSON.parse(response);
    process(data);
} catch (error) {
    console.error("è§£æå¤±è´¥:", error.message);
} finally {
    cleanup();
}

// JavaScript: Promise.catch
fetch('/api/data')
    .then(response => response.json())
    .then(data => process(data))
    .catch(error => console.error("è¯·æ±‚å¤±è´¥:", error))
    .finally(() => cleanup());
```

```python
# Python: try-except
try:
    data = json.loads(response)
    process(data)
except Exception as e:
    print(f"è§£æå¤±è´¥: {e}")
finally:
    cleanup()
```

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šæ¸¸æˆé‡Œçš„"å¤æ´»ç‚¹"

try-except å°±åƒæ¸¸æˆé‡Œçš„å¤æ´»ç‚¹/å­˜æ¡£ç‚¹ã€‚

**ç”Ÿæ´»ä¾‹å­ï¼š**
```
ä½ åœ¨ç©ä¸€ä¸ªå†’é™©æ¸¸æˆï¼š

1. å­˜æ¡£ç‚¹ï¼ˆtry å¼€å§‹ï¼‰
   "æˆ‘å‡†å¤‡å»æ‰“å¤§æ€ªå…½äº†ï¼"

2. å±é™©æ“ä½œï¼ˆtry é‡Œé¢çš„ä»£ç ï¼‰
   èµ°è¿›æ€ªå…½æ´ç©´...
   å’Œæ€ªå…½æˆ˜æ–—...

3. å¯èƒ½å‘ç”Ÿçš„æ„å¤–ï¼ˆå¼‚å¸¸ï¼‰
   - è¢«æ€ªå…½æ‰“è´¥äº†ï¼ˆGameOverExceptionï¼‰
   - æ‰è¿›é™·é˜±äº†ï¼ˆTrapExceptionï¼‰
   - è£…å¤‡åäº†ï¼ˆEquipmentExceptionï¼‰

4. å¤æ´»/å¤„ç†ï¼ˆexceptï¼‰
   å¦‚æœè¢«æ‰“è´¥äº† â†’ å›åˆ°å­˜æ¡£ç‚¹ï¼Œè¡¥æ»¡è¡€é‡
   å¦‚æœæ‰è¿›é™·é˜± â†’ å›åˆ°å­˜æ¡£ç‚¹ï¼Œæ¢æ¡è·¯
   å¦‚æœè£…å¤‡åäº† â†’ å»ä¿®ç†ä¸€ä¸‹

5. æ— è®ºå¦‚ä½•éƒ½è¦åšçš„äº‹ï¼ˆfinallyï¼‰
   ä¿å­˜æ¸¸æˆè¿›åº¦

æ²¡æœ‰å­˜æ¡£ç‚¹/å¤æ´»ç‚¹çš„è¯ï¼Œä¸€å¤±è´¥æ¸¸æˆå°±ç»“æŸäº†ï¼
æœ‰äº†å­˜æ¡£ç‚¹ï¼Œå¯ä»¥ä»å¤±è´¥ä¸­æ¢å¤ç»§ç»­ç©ï¼
```

---

### ç±»æ¯”2ï¼šå¼‚å¸¸å±‚æ¬¡ç»“æ„

#### ğŸ¨ å‰ç«¯è§†è§’ï¼šError ç»§æ‰¿ä½“ç³»

```javascript
// JavaScript çš„ Error å±‚æ¬¡
Error
â”œâ”€â”€ SyntaxError
â”œâ”€â”€ TypeError
â”œâ”€â”€ ReferenceError
â”œâ”€â”€ RangeError
â””â”€â”€ CustomError (è‡ªå®šä¹‰)

// è‡ªå®šä¹‰é”™è¯¯ç±»
class APIError extends Error {
    constructor(statusCode, message) {
        super(message);
        this.statusCode = statusCode;
        this.name = 'APIError';
    }
}

// æ•è·ç‰¹å®šç±»å‹
try {
    fetchData();
} catch (error) {
    if (error instanceof APIError) {
        console.log(`API é”™è¯¯: ${error.statusCode}`);
    } else if (error instanceof TypeError) {
        console.log('ç±»å‹é”™è¯¯');
    } else {
        console.log('å…¶ä»–é”™è¯¯');
    }
}
```

```python
# Python çš„å¼‚å¸¸å±‚æ¬¡
Exception
â”œâ”€â”€ ValueError
â”œâ”€â”€ TypeError
â”œâ”€â”€ KeyError
â””â”€â”€ CustomError (è‡ªå®šä¹‰)

# è‡ªå®šä¹‰å¼‚å¸¸ç±»
class APIError(Exception):
    def __init__(self, status_code, message):
        super().__init__(message)
        self.status_code = status_code

# æ•è·ç‰¹å®šç±»å‹
try:
    fetch_data()
except APIError as e:
    print(f"API é”™è¯¯: {e.status_code}")
except TypeError:
    print("ç±»å‹é”™è¯¯")
except Exception:
    print("å…¶ä»–é”™è¯¯")
```

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šä¸åŒç±»å‹çš„"ç”Ÿç—…"

å¼‚å¸¸å±‚æ¬¡å°±åƒä¸åŒç±»å‹çš„ç”Ÿç—…ï¼Œéœ€è¦ä¸åŒçš„æ²»ç–—æ–¹æ³•ã€‚

**ç”Ÿæ´»ä¾‹å­ï¼š**
```
èº«ä½“ä¸èˆ’æœï¼ˆExceptionï¼‰æ˜¯ä¸€ä¸ªå¤§ç±»ï¼š

èº«ä½“ä¸èˆ’æœ
â”œâ”€â”€ æ„Ÿå†’ï¼ˆColdExceptionï¼‰
â”‚   â”œâ”€â”€ æµé¼»æ¶•æ„Ÿå†’
â”‚   â””â”€â”€ å’³å—½æ„Ÿå†’
â”œâ”€â”€ è‚šå­ç–¼ï¼ˆStomachExceptionï¼‰
â”‚   â”œâ”€â”€ åƒåä¸œè¥¿äº†
â”‚   â””â”€â”€ ç€å‡‰äº†
â””â”€â”€ å—ä¼¤ï¼ˆInjuryExceptionï¼‰
    â”œâ”€â”€ æ‘”å€’æ“¦ä¼¤
    â””â”€â”€ æ’åˆ°å¤´äº†

ä¸åŒçš„ç—…éœ€è¦ä¸åŒçš„å¤„ç†ï¼š
- æ„Ÿå†’ â†’ å¤šå–çƒ­æ°´ã€åƒæ„Ÿå†’è¯
- è‚šå­ç–¼ â†’ çƒ­æ°´è¢‹æ‚è‚šå­ã€åƒè‚ èƒƒè¯
- å—ä¼¤ â†’ è´´åˆ›å¯è´´ã€å†°æ•·

å¦‚æœåªè¯´"èº«ä½“ä¸èˆ’æœ"ï¼ŒåŒ»ç”Ÿä¸çŸ¥é“æ€ä¹ˆæ²»ï¼
æ‰€ä»¥è¦è¯´å…·ä½“æ˜¯ä»€ä¹ˆç—…ï¼ˆå…·ä½“çš„å¼‚å¸¸ç±»å‹ï¼‰
```

---

### ç±»æ¯”3ï¼šfinally

#### ğŸ¨ å‰ç«¯è§†è§’ï¼šfinally / useEffect cleanup

```javascript
// Promise.finally - æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ‰§è¡Œ
fetch('/api/data')
    .then(handleSuccess)
    .catch(handleError)
    .finally(() => {
        hideLoadingSpinner();  // æ— è®ºå¦‚ä½•éƒ½è¦éšè—åŠ è½½åŠ¨ç”»
    });

// React useEffect cleanup
useEffect(() => {
    const subscription = api.subscribe();
    return () => {
        subscription.unsubscribe();  // ç»„ä»¶å¸è½½æ—¶æ¸…ç†
    };
}, []);
```

```python
# Python finally
try:
    show_loading()
    data = fetch_data()
except Exception:
    handle_error()
finally:
    hide_loading()  # æ— è®ºå¦‚ä½•éƒ½è¦éšè—åŠ è½½åŠ¨ç”»
```

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šç¡å‰å¿…é¡»åšçš„äº‹

finally å°±åƒç¡å‰å¿…é¡»åšçš„äº‹ï¼Œä¸ç®¡ä»Šå¤©æ€ä¹ˆæ ·éƒ½è¦åšã€‚

**ç”Ÿæ´»ä¾‹å­ï¼š**
```
ç¡å‰æµç¨‹ï¼š

tryï¼ˆä»Šå¤©çš„æ´»åŠ¨ï¼‰ï¼š
    åšä½œä¸š
    ç©æ¸¸æˆ
    çœ‹åŠ¨ç”»ç‰‡

exceptï¼ˆå¯èƒ½å‡ºç°çš„é—®é¢˜ï¼‰ï¼š
    å¦‚æœä½œä¸šå¤ªéš¾ â†’ é—®çˆ¸çˆ¸å¦ˆå¦ˆ
    å¦‚æœæ¸¸æˆè¾“äº† â†’ ä¸‹æ¬¡å†èµ¢å›æ¥
    å¦‚æœç”µè§†åäº† â†’ çœ‹ä¹¦ä»£æ›¿

finallyï¼ˆæ— è®ºå¦‚ä½•éƒ½è¦åšï¼‰ï¼š
    åˆ·ç‰™ âœ…
    æ´—è„¸ âœ…
    æ¢ç¡è¡£ âœ…
    è¯´æ™šå®‰ âœ…

ä¸ç®¡ä»Šå¤©å¼€ä¸å¼€å¿ƒã€ä½œä¸šåšæ²¡åšå®Œã€æ¸¸æˆèµ¢æ²¡èµ¢ï¼Œ
ç¡å‰çš„è¿™äº›äº‹éƒ½è¦åšï¼è¿™å°±æ˜¯ finallyï¼
```

---

### ç±»æ¯”4ï¼šraise æŠ›å‡ºå¼‚å¸¸

#### ğŸ¨ å‰ç«¯è§†è§’ï¼šthrow

```javascript
// JavaScript: throw
function validateAge(age) {
    if (age < 0) {
        throw new Error("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°");
    }
    if (age > 150) {
        throw new Error("å¹´é¾„ä¸å¤ªå¯¹å§...");
    }
    return age;
}

// é‡æ–°æŠ›å‡º
try {
    doSomething();
} catch (error) {
    console.log("è®°å½•é”™è¯¯");
    throw error;  // ç»§ç»­æŠ›å‡º
}
```

```python
# Python: raise
def validate_age(age):
    if age < 0:
        raise ValueError("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°")
    if age > 150:
        raise ValueError("å¹´é¾„ä¸å¤ªå¯¹å§...")
    return age

# é‡æ–°æŠ›å‡º
try:
    do_something()
except Exception:
    print("è®°å½•é”™è¯¯")
    raise  # ç»§ç»­æŠ›å‡º
```

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šä¸¾æ‰‹æŠ¥å‘Šé—®é¢˜

raise å°±åƒåœ¨è¯¾å ‚ä¸Šä¸¾æ‰‹æŠ¥å‘Šé—®é¢˜ç»™è€å¸ˆã€‚

**ç”Ÿæ´»ä¾‹å­ï¼š**
```
ä½ æ˜¯è¯¾ä»£è¡¨ï¼Œåœ¨æ£€æŸ¥åŒå­¦çš„ä½œä¸šï¼š

def æ£€æŸ¥ä½œä¸š(ä½œä¸š):
    if ä½œä¸š.åå­— == "":
        raise æ²¡å†™åå­—å¼‚å¸¸("è¯·å†™ä¸Šåå­—ï¼")

    if ä½œä¸š.å­—æ•° < 100:
        raise å­—æ•°ä¸å¤Ÿå¼‚å¸¸("å­—æ•°å¤ªå°‘äº†ï¼")

    if ä½œä¸š.å­—è¿¹ == "çœ‹ä¸æ¸…":
        raise å­—è¿¹æ½¦è‰å¼‚å¸¸("è¯·å†™å·¥æ•´ï¼")

    return "ä½œä¸šåˆæ ¼"

# å½“ä½ å‘ç°é—®é¢˜æ—¶ï¼š
# 1. ä¸¾æ‰‹ï¼ˆraiseï¼‰
# 2. å‘Šè¯‰è€å¸ˆå…·ä½“æ˜¯ä»€ä¹ˆé—®é¢˜ï¼ˆå¼‚å¸¸ç±»å‹ï¼‰
# 3. è€å¸ˆå†³å®šæ€ä¹ˆå¤„ç†ï¼ˆexceptï¼‰
```

---

### ç±»æ¯”5ï¼šwith ä¸Šä¸‹æ–‡ç®¡ç†å™¨

#### ğŸ¨ å‰ç«¯è§†è§’ï¼šusing / try-with-resources / ç”Ÿå‘½å‘¨æœŸ

```javascript
// JavaScript æ²¡æœ‰å®Œå…¨å¯¹åº”çš„è¯­æ³•ï¼Œä½†æœ‰ç±»ä¼¼æ¦‚å¿µ

// React ç”Ÿå‘½å‘¨æœŸç®¡ç†
class MyComponent extends React.Component {
    componentDidMount() {
        this.subscription = api.subscribe();  // è¿›å…¥
    }
    componentWillUnmount() {
        this.subscription.unsubscribe();      // é€€å‡ºæ—¶æ¸…ç†
    }
}

// æ¨¡æ‹Ÿ with çš„ pattern
const withResource = async (getResource, callback) => {
    const resource = await getResource();
    try {
        return await callback(resource);
    } finally {
        resource.close();
    }
};
```

```python
# Python with è¯­å¥
with open("file.txt") as f:
    content = f.read()
# è‡ªåŠ¨å…³é—­æ–‡ä»¶

# ç­‰ä»·äº
f = open("file.txt")
try:
    content = f.read()
finally:
    f.close()
```

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šå€Ÿä¸œè¥¿çš„è§„çŸ©

with å°±åƒå€Ÿä¸œè¥¿çš„å®Œæ•´æµç¨‹ï¼šå€Ÿå‡º â†’ ä½¿ç”¨ â†’ å½’è¿˜ã€‚

**ç”Ÿæ´»ä¾‹å­ï¼š**
```
å›¾ä¹¦é¦†å€Ÿä¹¦æµç¨‹ï¼š

with å›¾ä¹¦é¦†.å€Ÿä¹¦("ã€Šä¸‰ä½“ã€‹") as ä¹¦:
    é˜…è¯»(ä¹¦)
# è‡ªåŠ¨å½’è¿˜ï¼

å±•å¼€æ¥è¯´ï¼š
1. è¿›å…¥å›¾ä¹¦é¦†ï¼Œå€Ÿã€Šä¸‰ä½“ã€‹ï¼ˆ__enter__ï¼‰
2. é˜…è¯»è¿™æœ¬ä¹¦ï¼ˆwith å—é‡Œçš„ä»£ç ï¼‰
3. ä¸ç®¡çœ‹å®Œæ²¡çœ‹å®Œï¼Œå‡ºé—¨æ—¶éƒ½è¦è¿˜ä¹¦ï¼ˆ__exit__ï¼‰

å¥½å¤„ï¼š
- ä¸ä¼šå¿˜è®°è¿˜ä¹¦
- å³ä½¿çœ‹ä¹¦æ—¶ç¡ç€äº†ï¼ˆå¼‚å¸¸ï¼‰ï¼Œä¹¦ä¹Ÿä¼šè¢«å½’è¿˜
- å›¾ä¹¦ç®¡ç†å‘˜ï¼ˆPythonï¼‰å¸®ä½ ç®¡ç†æ•´ä¸ªæµç¨‹

å¯¹æ¯”ä¸ç”¨ withï¼š
ä¹¦ = å›¾ä¹¦é¦†.å€Ÿä¹¦("ã€Šä¸‰ä½“ã€‹")
try:
    é˜…è¯»(ä¹¦)
finally:
    å›¾ä¹¦é¦†.è¿˜ä¹¦(ä¹¦)  # å¿…é¡»è®°å¾—æ‰‹åŠ¨è¿˜ï¼
```

---

### ç±»æ¯”æ€»ç»“è¡¨

| Python å¼‚å¸¸æ¦‚å¿µ | å‰ç«¯ç±»æ¯” | å°æœ‹å‹ç±»æ¯” |
|---------------|---------|-----------|
| `try-except` | try-catch | æ¸¸æˆå­˜æ¡£ç‚¹/å¤æ´»ç‚¹ |
| `finally` | Promise.finally | ç¡å‰å¿…é¡»åšçš„äº‹ |
| `raise` | throw | ä¸¾æ‰‹æŠ¥å‘Šé—®é¢˜ |
| å¼‚å¸¸å±‚æ¬¡ | Error ç»§æ‰¿ä½“ç³» | ä¸åŒç±»å‹çš„ç”Ÿç—… |
| è‡ªå®šä¹‰å¼‚å¸¸ | è‡ªå®šä¹‰ Error ç±» | è‡ªå®šä¹‰é—®é¢˜ç±»å‹ |
| `with` è¯­å¥ | try-with-resources | å€Ÿä¸œè¥¿çš„è§„çŸ© |
| å¼‚å¸¸é“¾ `from` | Error.cause | é—®é¢˜çš„æ ¹æœ¬åŸå›  |
| `else` å— | æˆåŠŸå›è°ƒ | å¦‚æœä¸€åˆ‡é¡ºåˆ© |
| æ•è·æ‰€æœ‰ | catch(error) | ä¸‡èƒ½åº”æ€¥æ–¹æ¡ˆ |
| å¼‚å¸¸å±æ€§ | error.message | é”™è¯¯çš„è¯¦ç»†è¯´æ˜ |

---

## 6. ã€åç›´è§‰ç‚¹ã€‘

### è¯¯åŒº1ï¼šæ•è·æ‰€æœ‰å¼‚å¸¸ `except:` æˆ– `except Exception:` æ˜¯å¥½ä¹ æƒ¯ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- æ•è·å¤ªå®½æ³›ä¼šéšè—çœŸæ­£çš„ bug
- ä¼šæ•è·æœ¬ä¸åº”è¯¥æ•è·çš„å¼‚å¸¸ï¼ˆå¦‚ `KeyboardInterrupt`ï¼‰
- è®©è°ƒè¯•å˜å¾—å›°éš¾

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
"å®½å®¹"çš„å¿ƒæ€â€”â€”"æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œç¨‹åºå°±ä¸ä¼šå´©æºƒäº†ï¼" ä½†è¿™åªæ˜¯æŠŠé—®é¢˜è—èµ·æ¥ï¼Œè€Œä¸æ˜¯è§£å†³ã€‚

**æ­£ç¡®ç†è§£ï¼š**

```python
# âŒ ä¸å¥½ï¼šæ•è·æ‰€æœ‰å¼‚å¸¸
try:
    result = process_data(data)
except:
    print("å‡ºé”™äº†")  # ä»€ä¹ˆé”™ï¼Ÿä¸çŸ¥é“ï¼

# âŒ ä¸å¥½ï¼šå¤ªå®½æ³›
try:
    result = process_data(data)
except Exception:
    pass  # åæ‰æ‰€æœ‰å¼‚å¸¸ï¼Œå‡è£…æ²¡äº‹

# âœ… å¥½ï¼šæ•è·ç‰¹å®šå¼‚å¸¸
try:
    result = process_data(data)
except ValueError as e:
    print(f"æ•°æ®æ ¼å¼é”™è¯¯: {e}")
except KeyError as e:
    print(f"ç¼ºå°‘å¿…è¦å­—æ®µ: {e}")
except Exception as e:
    # å…œåº•ï¼Œä½†è¦è®°å½•æ—¥å¿—
    logger.error(f"æœªé¢„æœŸçš„é”™è¯¯: {e}", exc_info=True)
    raise  # é‡æ–°æŠ›å‡ºï¼Œä¸è¦é»˜é»˜åæ‰
```

**ä»€ä¹ˆæ—¶å€™å¯ä»¥ç”¨ `except Exception`ï¼Ÿ**

```python
# 1. ä½œä¸ºå…œåº•ï¼Œä½†è¦è®°å½•å¹¶é‡æ–°æŠ›å‡º
try:
    do_something()
except SpecificError:
    handle_specific()
except Exception as e:
    logger.error(f"Unexpected: {e}")
    raise  # é‡è¦ï¼šé‡æ–°æŠ›å‡º

# 2. åœ¨æœ€é¡¶å±‚é˜²æ­¢ç¨‹åºå´©æºƒ
def main():
    try:
        run_application()
    except Exception as e:
        show_error_dialog(e)
        save_crash_report(e)
        return 1
```

---

### è¯¯åŒº2ï¼šå¼‚å¸¸åªæ˜¯ç”¨æ¥"æ•è·é”™è¯¯"çš„ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- å¼‚å¸¸ä¹Ÿæ˜¯é‡è¦çš„**æ²Ÿé€šå·¥å…·**
- ç”¨äºè¡¨ç¤º"ä¸æ­£å¸¸ä½†å¯é¢„æœŸ"çš„æƒ…å†µ
- å¯ä»¥ç”¨äºæ§åˆ¶æµç¨‹ï¼ˆè™½ç„¶è¦è°¨æ…ï¼‰

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
"å¼‚å¸¸"è¿™ä¸ªè¯ç»™äººè´Ÿé¢å°è±¡ï¼Œè§‰å¾—æ˜¯"åäº‹"ã€‚ä½†åœ¨ Python ä¸­ï¼Œå¼‚å¸¸æ˜¯ä¸€ç§æ­£å¸¸çš„ç¨‹åºæœºåˆ¶ã€‚

**æ­£ç¡®ç†è§£ï¼š**

```python
# å¼‚å¸¸ä½œä¸ºé€šä¿¡æœºåˆ¶
class StopProcessing(Exception):
    """åœæ­¢å¤„ç†ä¿¡å·"""
    pass

def process_items(items):
    for item in items:
        try:
            result = process_one(item)
            if should_stop(result):
                raise StopProcessing("è¾¾åˆ°å¤„ç†ä¸Šé™")
        except StopProcessing as e:
            print(f"åœæ­¢: {e}")
            break

# å¼‚å¸¸æºå¸¦ä¸°å¯Œä¿¡æ¯
class ValidationError(Exception):
    def __init__(self, errors: list):
        self.errors = errors
        super().__init__(f"å‘ç° {len(errors)} ä¸ªéªŒè¯é”™è¯¯")

try:
    validate(data)
except ValidationError as e:
    for error in e.errors:
        print(f"- {error}")

# Python å†…ç½®çš„å¼‚å¸¸ç”¨æ³•
# StopIteration - è¿­ä»£å™¨ç»“æŸ
# GeneratorExit - ç”Ÿæˆå™¨å…³é—­
# è¿™äº›éƒ½ä¸æ˜¯"é”™è¯¯"ï¼Œè€Œæ˜¯"ä¿¡å·"
```

---

### è¯¯åŒº3ï¼š`finally` æ€»æ˜¯ä¼šæ‰§è¡Œ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- `finally` åœ¨æ­£å¸¸æƒ…å†µä¸‹æ€»ä¼šæ‰§è¡Œ
- ä½†æœ‰å‡ ä¸ªç‰¹æ®Šæƒ…å†µå®ƒä¸ä¼šæ‰§è¡Œ

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
æ•™ç¨‹è¯´"finally æ€»æ˜¯æ‰§è¡Œ"ï¼Œä½†å¿½ç•¥äº†è¾¹ç•Œæƒ…å†µã€‚

**æ­£ç¡®ç†è§£ï¼š**

```python
# æƒ…å†µ1ï¼šos._exit() ç›´æ¥é€€å‡º
import os

try:
    print("å¼€å§‹")
    os._exit(1)  # ç›´æ¥é€€å‡ºï¼Œä¸ç»è¿‡ finally
except:
    print("å¼‚å¸¸")  # ä¸æ‰§è¡Œ
finally:
    print("finally")  # ä¸æ‰§è¡Œï¼

# æƒ…å†µ2ï¼šè¿›ç¨‹è¢«å¼ºåˆ¶ç»ˆæ­¢
# kill -9 pid ä¼šç›´æ¥æ€æ­»è¿›ç¨‹ï¼Œfinally ä¸æ‰§è¡Œ

# æƒ…å†µ3ï¼šæ— é™å¾ªç¯æˆ–æ­»é”
try:
    while True:
        pass  # æ°¸è¿œä¸ä¼šåˆ°è¾¾ finally
finally:
    print("finally")  # å¦‚æœå¾ªç¯æ°¸è¿œä¸ç»“æŸï¼Œè¿™é‡Œä¸ä¼šæ‰§è¡Œ

# æƒ…å†µ4ï¼šè§£é‡Šå™¨å´©æºƒ
# å¦‚æœ Python è§£é‡Šå™¨æœ¬èº«å´©æºƒï¼ˆæ®µé”™è¯¯ç­‰ï¼‰ï¼Œfinally ä¸ä¼šæ‰§è¡Œ

# æ­£å¸¸æƒ…å†µä¸‹ finally éƒ½ä¼šæ‰§è¡Œ
# åŒ…æ‹¬ï¼šreturnã€breakã€continueã€å¼‚å¸¸
def test():
    try:
        return "ç»“æœ"
    finally:
        print("finally æ‰§è¡Œäº†")  # ä¼šæ‰§è¡Œï¼

result = test()  # è¾“å‡º "finally æ‰§è¡Œäº†"ï¼Œç„¶åè¿”å› "ç»“æœ"
```

---

## 7. ã€å®æˆ˜ä»£ç ã€‘

```python
"""
ç¤ºä¾‹ï¼šæ„å»º LangChain é£æ ¼çš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿ
æ¼”ç¤ºå¼‚å¸¸å¤„ç†åœ¨ LLM åº”ç”¨ä¸­çš„æ ¸å¿ƒç”¨æ³•
"""

from abc import ABC, abstractmethod
from typing import Any, Dict, List, Optional, Type
from dataclasses import dataclass
from contextlib import contextmanager
import json
import time

# ===== 1. è‡ªå®šä¹‰å¼‚å¸¸å±‚æ¬¡ç»“æ„ =====
print("=== 1. è‡ªå®šä¹‰å¼‚å¸¸å±‚æ¬¡ç»“æ„ ===")

class LLMApplicationError(Exception):
    """LLM åº”ç”¨å¼‚å¸¸åŸºç±»"""

    def __init__(self, message: str, recoverable: bool = True):
        super().__init__(message)
        self.recoverable = recoverable

class APIError(LLMApplicationError):
    """API è°ƒç”¨é”™è¯¯"""

    def __init__(self, status_code: int, message: str):
        self.status_code = status_code
        super().__init__(f"API é”™è¯¯ [{status_code}]: {message}")

class RateLimitError(APIError):
    """é€Ÿç‡é™åˆ¶é”™è¯¯"""

    def __init__(self, retry_after: float = 60.0):
        self.retry_after = retry_after
        super().__init__(429, f"é€Ÿç‡é™åˆ¶ï¼Œ{retry_after}s åé‡è¯•")

class OutputParserError(LLMApplicationError):
    """è¾“å‡ºè§£æé”™è¯¯"""

    def __init__(self, message: str, llm_output: str):
        self.llm_output = llm_output
        super().__init__(f"è§£æé”™è¯¯: {message}")

class ValidationError(LLMApplicationError):
    """éªŒè¯é”™è¯¯"""

    def __init__(self, field: str, value: Any, reason: str):
        self.field = field
        self.value = value
        self.reason = reason
        super().__init__(f"éªŒè¯å¤±è´¥ [{field}]: {reason}")

# å±•ç¤ºå¼‚å¸¸å±‚æ¬¡
print("å¼‚å¸¸å±‚æ¬¡ç»“æ„:")
print("  LLMApplicationError")
print("  â”œâ”€â”€ APIError")
print("  â”‚   â””â”€â”€ RateLimitError")
print("  â”œâ”€â”€ OutputParserError")
print("  â””â”€â”€ ValidationError")

# ===== 2. åŸºç¡€å¼‚å¸¸å¤„ç† =====
print("\n=== 2. åŸºç¡€å¼‚å¸¸å¤„ç† ===")

def parse_json_response(text: str) -> Dict:
    """è§£æ JSON å“åº” - å±•ç¤ºåŸºç¡€å¼‚å¸¸å¤„ç†"""
    try:
        data = json.loads(text)
        return data
    except json.JSONDecodeError as e:
        print(f"JSON è§£æå¤±è´¥: {e}")
        return {}

# æµ‹è¯•
valid_json = '{"name": "Alice", "age": 25}'
invalid_json = '{name: Alice}'

print(f"æœ‰æ•ˆ JSON: {parse_json_response(valid_json)}")
print(f"æ— æ•ˆ JSON: {parse_json_response(invalid_json)}")

# ===== 3. å¤šå±‚å¼‚å¸¸å¤„ç† =====
print("\n=== 3. å¤šå±‚å¼‚å¸¸å¤„ç† ===")

def process_llm_response(response: str) -> Dict:
    """å¤„ç† LLM å“åº” - å±•ç¤ºå¤šå±‚å¼‚å¸¸å¤„ç†"""
    try:
        # å°è¯•è§£æ JSON
        data = json.loads(response)

        # éªŒè¯å¿…è¦å­—æ®µ
        if "result" not in data:
            raise KeyError("ç¼ºå°‘ 'result' å­—æ®µ")

        # éªŒè¯æ•°æ®ç±»å‹
        if not isinstance(data["result"], str):
            raise TypeError("'result' å¿…é¡»æ˜¯å­—ç¬¦ä¸²")

        return data

    except json.JSONDecodeError as e:
        print(f"è§£æé”™è¯¯: {e.msg}")
        raise OutputParserError("JSON æ ¼å¼æ— æ•ˆ", response) from e

    except KeyError as e:
        print(f"å­—æ®µç¼ºå¤±: {e}")
        raise OutputParserError(f"ç¼ºå°‘å¿…è¦å­—æ®µ: {e}", response) from e

    except TypeError as e:
        print(f"ç±»å‹é”™è¯¯: {e}")
        raise OutputParserError(f"ç±»å‹é”™è¯¯: {e}", response) from e

# æµ‹è¯•
responses = [
    '{"result": "Hello!"}',      # æ­£å¸¸
    '{"data": "Hello!"}',        # ç¼ºå°‘å­—æ®µ
    '{invalid}',                  # JSON æ— æ•ˆ
]

for resp in responses:
    try:
        result = process_llm_response(resp)
        print(f"æˆåŠŸ: {result}")
    except OutputParserError as e:
        print(f"å¤±è´¥: {e}")

# ===== 4. try-except-else-finally å®Œæ•´ç»“æ„ =====
print("\n=== 4. å®Œæ•´çš„ try-except-else-finally ===")

def fetch_and_process(url: str) -> Optional[Dict]:
    """æ¨¡æ‹Ÿè·å–å’Œå¤„ç†æ•°æ® - å±•ç¤ºå®Œæ•´ç»“æ„"""
    connection = None
    try:
        # æ¨¡æ‹Ÿå»ºç«‹è¿æ¥
        print(f"  è¿æ¥åˆ° {url}")
        connection = {"url": url, "status": "connected"}

        # æ¨¡æ‹Ÿè·å–æ•°æ®ï¼ˆå¯èƒ½å¤±è´¥ï¼‰
        if "error" in url:
            raise ConnectionError("æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨")

        data = {"source": url, "content": "æ•°æ®å†…å®¹"}

    except ConnectionError as e:
        print(f"  è¿æ¥é”™è¯¯: {e}")
        return None

    except Exception as e:
        print(f"  æœªçŸ¥é”™è¯¯: {e}")
        return None

    else:
        # åªæœ‰æˆåŠŸæ—¶æ‰æ‰§è¡Œ
        print(f"  æˆåŠŸè·å–æ•°æ®")
        return data

    finally:
        # æ— è®ºå¦‚ä½•éƒ½æ‰§è¡Œ
        if connection:
            print(f"  å…³é—­è¿æ¥")
            connection = None

# æµ‹è¯•
print("æµ‹è¯•æ­£å¸¸ URL:")
result1 = fetch_and_process("https://api.example.com/data")

print("\næµ‹è¯•é”™è¯¯ URL:")
result2 = fetch_and_process("https://api.error.com/data")

# ===== 5. å¼‚å¸¸é“¾ (raise from) =====
print("\n=== 5. å¼‚å¸¸é“¾ ===")

def low_level_operation():
    """åº•å±‚æ“ä½œ"""
    raise ValueError("åŸå§‹é”™è¯¯ï¼šæ•°æ®æ ¼å¼ä¸æ­£ç¡®")

def mid_level_operation():
    """ä¸­å±‚æ“ä½œ"""
    try:
        low_level_operation()
    except ValueError as e:
        raise RuntimeError("ä¸­å±‚å¤„ç†å¤±è´¥") from e

def high_level_operation():
    """é«˜å±‚æ“ä½œ"""
    try:
        mid_level_operation()
    except RuntimeError as e:
        raise LLMApplicationError("åº”ç”¨å±‚æ“ä½œå¤±è´¥") from e

try:
    high_level_operation()
except LLMApplicationError as e:
    print(f"æ•è·å¼‚å¸¸: {e}")
    print(f"ç›´æ¥åŸå› : {e.__cause__}")
    print(f"æ ¹æœ¬åŸå› : {e.__cause__.__cause__}")

# ===== 6. ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸å¼‚å¸¸ =====
print("\n=== 6. ä¸Šä¸‹æ–‡ç®¡ç†å™¨ ===")

class APIConnection:
    """API è¿æ¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""

    def __init__(self, api_name: str):
        self.api_name = api_name
        self.connected = False

    def __enter__(self):
        print(f"  è¿æ¥åˆ° {self.api_name}")
        self.connected = True
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        print(f"  æ–­å¼€ {self.api_name} è¿æ¥")
        self.connected = False
        # è¿”å› False è¡¨ç¤ºä¸æŠ‘åˆ¶å¼‚å¸¸
        return False

    def call(self, prompt: str) -> str:
        if not self.connected:
            raise RuntimeError("æœªè¿æ¥")
        return f"å“åº”: {prompt[::-1]}"

# æµ‹è¯•æ­£å¸¸æƒ…å†µ
print("æ­£å¸¸è°ƒç”¨:")
with APIConnection("OpenAI") as api:
    result = api.call("Hello")
    print(f"  ç»“æœ: {result}")

# æµ‹è¯•å¼‚å¸¸æƒ…å†µ
print("\nå¼‚å¸¸è°ƒç”¨:")
try:
    with APIConnection("OpenAI") as api:
        result = api.call("Hello")
        raise ValueError("æ¨¡æ‹Ÿé”™è¯¯")  # å³ä½¿å‡ºé”™ï¼Œè¿æ¥ä¹Ÿä¼šå…³é—­
except ValueError:
    print("  æ•è·åˆ°æ¨¡æ‹Ÿé”™è¯¯")

# ===== 7. @contextmanager è£…é¥°å™¨ =====
print("\n=== 7. @contextmanager è£…é¥°å™¨ ===")

@contextmanager
def timer(name: str):
    """è®¡æ—¶ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
    start = time.time()
    print(f"  å¼€å§‹ {name}")
    try:
        yield
    except Exception as e:
        print(f"  {name} å‡ºé”™: {e}")
        raise
    finally:
        elapsed = time.time() - start
        print(f"  {name} å®Œæˆï¼Œè€—æ—¶ {elapsed:.4f}s")

with timer("æ•°æ®å¤„ç†"):
    # æ¨¡æ‹Ÿä¸€äº›æ“ä½œ
    time.sleep(0.1)
    print("  å¤„ç†ä¸­...")

# ===== 8. é‡è¯•æœºåˆ¶ =====
print("\n=== 8. é‡è¯•æœºåˆ¶ ===")

def retry_on_exception(
    max_retries: int = 3,
    exceptions: tuple = (Exception,),
    delay: float = 1.0
):
    """é‡è¯•è£…é¥°å™¨"""
    def decorator(func):
        def wrapper(*args, **kwargs):
            last_exception = None
            for attempt in range(max_retries):
                try:
                    return func(*args, **kwargs)
                except exceptions as e:
                    last_exception = e
                    print(f"  å°è¯• {attempt + 1}/{max_retries} å¤±è´¥: {e}")
                    if attempt < max_retries - 1:
                        time.sleep(delay * 0.1)  # ç¼©çŸ­å»¶è¿Ÿç”¨äºæ¼”ç¤º
            raise last_exception
        return wrapper
    return decorator

# æ¨¡æ‹Ÿä¸ç¨³å®šçš„ API
call_count = 0

@retry_on_exception(max_retries=3, exceptions=(ConnectionError,))
def unstable_api_call():
    global call_count
    call_count += 1
    if call_count < 3:
        raise ConnectionError("è¿æ¥å¤±è´¥")
    return "æˆåŠŸï¼"

try:
    result = unstable_api_call()
    print(f"  æœ€ç»ˆç»“æœ: {result}")
except ConnectionError as e:
    print(f"  æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥: {e}")

# ===== 9. LangChain é£æ ¼çš„ Runnable å¼‚å¸¸å¤„ç† =====
print("\n=== 9. Runnable å¼‚å¸¸å¤„ç† ===")

class Runnable(ABC):
    """å¯è¿è¡Œç»„ä»¶åŸºç±»"""

    @abstractmethod
    def invoke(self, input: Any) -> Any:
        pass

    def with_fallback(self, fallback: "Runnable") -> "RunnableWithFallback":
        """æ·»åŠ é™çº§å¤„ç†"""
        return RunnableWithFallback(self, fallback)

class RunnableWithFallback(Runnable):
    """å¸¦é™çº§çš„ Runnable"""

    def __init__(self, main: Runnable, fallback: Runnable):
        self.main = main
        self.fallback = fallback

    def invoke(self, input: Any) -> Any:
        try:
            return self.main.invoke(input)
        except Exception as e:
            print(f"  ä¸»è·¯å¾„å¤±è´¥: {e}ï¼Œä½¿ç”¨é™çº§")
            return self.fallback.invoke(input)

class FakeLLM(Runnable):
    """æ¨¡æ‹Ÿ LLM"""

    def __init__(self, name: str, fail: bool = False):
        self.name = name
        self.fail = fail

    def invoke(self, input: Any) -> str:
        if self.fail:
            raise APIError(500, f"{self.name} æœåŠ¡ä¸å¯ç”¨")
        return f"[{self.name}] å“åº”: {input}"

# åˆ›å»ºå¸¦é™çº§çš„ LLM
primary_llm = FakeLLM("GPT-4", fail=True)
fallback_llm = FakeLLM("GPT-3.5", fail=False)
robust_llm = primary_llm.with_fallback(fallback_llm)

result = robust_llm.invoke("Hello")
print(f"  ç»“æœ: {result}")

# ===== 10. ç»¼åˆç¤ºä¾‹ï¼šLLM åº”ç”¨é”™è¯¯å¤„ç† =====
print("\n=== 10. ç»¼åˆç¤ºä¾‹ ===")

class LLMApplication:
    """LLM åº”ç”¨ - å±•ç¤ºç»¼åˆå¼‚å¸¸å¤„ç†"""

    def __init__(self):
        self.llm = FakeLLM("GPT-4", fail=False)

    def process(self, query: str) -> Dict:
        """å¤„ç†ç”¨æˆ·æŸ¥è¯¢"""
        try:
            # 1. éªŒè¯è¾“å…¥
            self._validate_input(query)

            # 2. è°ƒç”¨ LLM
            with timer("LLM è°ƒç”¨"):
                response = self.llm.invoke(query)

            # 3. è§£æå“åº”
            result = self._parse_response(response)

            return {"status": "success", "result": result}

        except ValidationError as e:
            return {"status": "error", "type": "validation", "message": str(e)}

        except APIError as e:
            if e.recoverable:
                return {"status": "error", "type": "api", "message": str(e)}
            raise

        except OutputParserError as e:
            return {"status": "error", "type": "parsing", "message": str(e)}

        except Exception as e:
            # è®°å½•æœªé¢„æœŸçš„é”™è¯¯
            print(f"  æœªé¢„æœŸé”™è¯¯: {type(e).__name__}: {e}")
            raise

    def _validate_input(self, query: str):
        """éªŒè¯è¾“å…¥"""
        if not query or not query.strip():
            raise ValidationError("query", query, "æŸ¥è¯¢ä¸èƒ½ä¸ºç©º")
        if len(query) > 1000:
            raise ValidationError("query", f"{len(query)} chars", "æŸ¥è¯¢è¿‡é•¿")

    def _parse_response(self, response: str) -> str:
        """è§£æå“åº”"""
        # ç®€å•çš„è§£æé€»è¾‘
        return response.strip()

# æµ‹è¯•
app = LLMApplication()

print("æ­£å¸¸æŸ¥è¯¢:")
result1 = app.process("ä»€ä¹ˆæ˜¯ LangChainï¼Ÿ")
print(f"  ç»“æœ: {result1}")

print("\nç©ºæŸ¥è¯¢:")
result2 = app.process("")
print(f"  ç»“æœ: {result2}")

print("\n=== å®Œæˆ ===")
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**

```
=== 1. è‡ªå®šä¹‰å¼‚å¸¸å±‚æ¬¡ç»“æ„ ===
å¼‚å¸¸å±‚æ¬¡ç»“æ„:
  LLMApplicationError
  â”œâ”€â”€ APIError
  â”‚   â””â”€â”€ RateLimitError
  â”œâ”€â”€ OutputParserError
  â””â”€â”€ ValidationError

=== 2. åŸºç¡€å¼‚å¸¸å¤„ç† ===
æœ‰æ•ˆ JSON: {'name': 'Alice', 'age': 25}
JSON è§£æå¤±è´¥: Expecting property name enclosed in double quotes: line 1 column 2 (char 1)
æ— æ•ˆ JSON: {}

=== 3. å¤šå±‚å¼‚å¸¸å¤„ç† ===
æˆåŠŸ: {'result': 'Hello!'}
å­—æ®µç¼ºå¤±: 'result'
å¤±è´¥: è§£æé”™è¯¯: ç¼ºå°‘å¿…è¦å­—æ®µ: 'result'
è§£æé”™è¯¯: Expecting property name enclosed in double quotes: line 1 column 2 (char 1)
å¤±è´¥: è§£æé”™è¯¯: JSON æ ¼å¼æ— æ•ˆ

=== 4. å®Œæ•´çš„ try-except-else-finally ===
æµ‹è¯•æ­£å¸¸ URL:
  è¿æ¥åˆ° https://api.example.com/data
  æˆåŠŸè·å–æ•°æ®
  å…³é—­è¿æ¥

æµ‹è¯•é”™è¯¯ URL:
  è¿æ¥åˆ° https://api.error.com/data
  è¿æ¥é”™è¯¯: æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨
  å…³é—­è¿æ¥

=== 5. å¼‚å¸¸é“¾ ===
æ•è·å¼‚å¸¸: åº”ç”¨å±‚æ“ä½œå¤±è´¥
ç›´æ¥åŸå› : ä¸­å±‚å¤„ç†å¤±è´¥
æ ¹æœ¬åŸå› : åŸå§‹é”™è¯¯ï¼šæ•°æ®æ ¼å¼ä¸æ­£ç¡®

=== 6. ä¸Šä¸‹æ–‡ç®¡ç†å™¨ ===
æ­£å¸¸è°ƒç”¨:
  è¿æ¥åˆ° OpenAI
  ç»“æœ: å“åº”: olleH
  æ–­å¼€ OpenAI è¿æ¥

å¼‚å¸¸è°ƒç”¨:
  è¿æ¥åˆ° OpenAI
  æ–­å¼€ OpenAI è¿æ¥
  æ•è·åˆ°æ¨¡æ‹Ÿé”™è¯¯

=== 7. @contextmanager è£…é¥°å™¨ ===
  å¼€å§‹ æ•°æ®å¤„ç†
  å¤„ç†ä¸­...
  æ•°æ®å¤„ç† å®Œæˆï¼Œè€—æ—¶ 0.1003s

=== 8. é‡è¯•æœºåˆ¶ ===
  å°è¯• 1/3 å¤±è´¥: è¿æ¥å¤±è´¥
  å°è¯• 2/3 å¤±è´¥: è¿æ¥å¤±è´¥
  æœ€ç»ˆç»“æœ: æˆåŠŸï¼

=== 9. Runnable å¼‚å¸¸å¤„ç† ===
  ä¸»è·¯å¾„å¤±è´¥: API é”™è¯¯ [500]: GPT-4 æœåŠ¡ä¸å¯ç”¨ï¼Œä½¿ç”¨é™çº§
  ç»“æœ: [GPT-3.5] å“åº”: Hello

=== 10. ç»¼åˆç¤ºä¾‹ ===
æ­£å¸¸æŸ¥è¯¢:
  å¼€å§‹ LLM è°ƒç”¨
  LLM è°ƒç”¨ å®Œæˆï¼Œè€—æ—¶ 0.0001s
  ç»“æœ: {'status': 'success', 'result': '[GPT-4] å“åº”: ä»€ä¹ˆæ˜¯ LangChainï¼Ÿ'}

ç©ºæŸ¥è¯¢:
  ç»“æœ: {'status': 'error', 'type': 'validation', 'message': 'éªŒè¯å¤±è´¥ [query]: æŸ¥è¯¢ä¸èƒ½ä¸ºç©º'}

=== å®Œæˆ ===
```

---

## 8. ã€é¢è¯•å¿…é—®ã€‘

### é—®é¢˜ï¼š"Python ä¸­å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸ï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"ç”¨ try-except æ•è·å¼‚å¸¸ï¼Œç„¶åæ‰“å°é”™è¯¯ä¿¡æ¯æˆ–è€…è¿”å›é»˜è®¤å€¼ã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **ä¼˜é›…çš„å¼‚å¸¸å¤„ç†æœ‰å››ä¸ªåŸåˆ™ï¼š**
>
> 1. **ç²¾ç¡®æ•è·**ï¼šåªæ•è·ä½ é¢„æœŸçš„ã€èƒ½å¤„ç†çš„å¼‚å¸¸
>    ```python
>    # âŒ å¤ªå®½æ³›
>    except Exception: pass
>
>    # âœ… ç²¾ç¡®æ•è·
>    except ValueError as e:
>        log.warning(f"æ•°æ®æ ¼å¼é”™è¯¯: {e}")
>        return default_value
>    ```
>
> 2. **ä¿ç•™ä¿¡æ¯**ï¼šä½¿ç”¨å¼‚å¸¸é“¾ä¿ç•™åŸå§‹é”™è¯¯
>    ```python
>    except OriginalError as e:
>        raise MyCustomError("å¤„ç†å¤±è´¥") from e
>    ```
>
> 3. **é€‚å½“ä¼ æ’­**ï¼šä¸èƒ½å¤„ç†çš„å¼‚å¸¸è¦å‘ä¸Šä¼ é€’
>    ```python
>    except NetworkError:
>        # è®°å½•æ—¥å¿—ï¼Œä½†è®©è°ƒç”¨è€…çŸ¥é“å¤±è´¥äº†
>        logger.error("ç½‘ç»œé”™è¯¯")
>        raise
>    ```
>
> 4. **æ¸…ç†èµ„æº**ï¼šä½¿ç”¨ `with` æˆ– `finally` ç¡®ä¿èµ„æºé‡Šæ”¾
>    ```python
>    with open(file) as f:
>        process(f)
>    # è‡ªåŠ¨å…³é—­ï¼Œå³ä½¿å‡ºé”™
>    ```
>
> **åœ¨ LangChain ä¸­çš„å®è·µ**ï¼š
> ```python
> # LangChain çš„ OutputParser å°±æ˜¯å¾ˆå¥½çš„ä¾‹å­
> try:
>     result = parser.parse(llm_output)
> except OutputParserException as e:
>     if e.send_to_llm:
>         # å¯æ¢å¤ï¼šè®© LLM é‡æ–°ç”Ÿæˆ
>         result = retry_with_feedback(e.observation)
>     else:
>         # ä¸å¯æ¢å¤ï¼šå‘ä¸Šä¼ é€’
>         raise
> ```

**ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©ï¼Ÿ**
1. âœ… ç»™å‡ºäº†æ¸…æ™°çš„åŸåˆ™æ¡†æ¶
2. âœ… æ¯ä¸ªåŸåˆ™éƒ½æœ‰ä»£ç ç¤ºä¾‹
3. âœ… è”ç³»äº†å®é™…æ¡†æ¶çš„åº”ç”¨
4. âœ… å±•ç¤ºäº†"å¯æ¢å¤"å’Œ"ä¸å¯æ¢å¤"çš„åŒºåˆ†

---

### é—®é¢˜ï¼š"ä»€ä¹ˆæ—¶å€™åº”è¯¥è‡ªå®šä¹‰å¼‚å¸¸ï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"å½“å†…ç½®å¼‚å¸¸ä¸å¤Ÿç”¨çš„æ—¶å€™å°±è‡ªå®šä¹‰å¼‚å¸¸ã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **è‡ªå®šä¹‰å¼‚å¸¸æœ‰ä¸‰ä¸ªä½¿ç”¨åœºæ™¯ï¼š**
>
> 1. **ä¸šåŠ¡è¯­ä¹‰**ï¼šè¡¨è¾¾ç‰¹å®šçš„ä¸šåŠ¡é”™è¯¯
>    ```python
>    class InsufficientBalanceError(Exception):
>        def __init__(self, balance, required):
>            self.balance = balance
>            self.required = required
>            super().__init__(f"ä½™é¢ä¸è¶³: {balance}/{required}")
>    ```
>
> 2. **æºå¸¦ä¸Šä¸‹æ–‡**ï¼šéœ€è¦ä¼ é€’é¢å¤–ä¿¡æ¯
>    ```python
>    class OutputParserError(Exception):
>        def __init__(self, message, llm_output, recoverable=True):
>            self.llm_output = llm_output
>            self.recoverable = recoverable
>            super().__init__(message)
>    ```
>
> 3. **å±‚æ¬¡åˆ†ç±»**ï¼šåŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯
>    ```python
>    class LLMError(Exception): pass
>    class RateLimitError(LLMError): pass
>    class TokenLimitError(LLMError): pass
>    class AuthenticationError(LLMError): pass
>    ```
>
> **åˆ¤æ–­æ ‡å‡†**ï¼š
> - è°ƒç”¨è€…éœ€è¦åŒºåˆ†å¤„ç†å—ï¼Ÿâ†’ è‡ªå®šä¹‰
> - éœ€è¦æºå¸¦é¢å¤–ä¿¡æ¯å—ï¼Ÿâ†’ è‡ªå®šä¹‰
> - åªæ˜¯ç®€å•çš„é”™è¯¯æç¤ºï¼Ÿâ†’ ç”¨å†…ç½® `ValueError` ç­‰
>
> **LangChain çš„ä¾‹å­**ï¼š
> ```python
> # LangChain å®šä¹‰äº†ä¸°å¯Œçš„è‡ªå®šä¹‰å¼‚å¸¸
> OutputParserException  # å¯ä»¥æºå¸¦ llm_outputï¼Œæ”¯æŒé‡è¯•
> LLMChainException     # åŒºåˆ† Chain å±‚é¢çš„é”™è¯¯
>
> # è¿™æ ·è°ƒç”¨è€…å¯ä»¥ç²¾ç¡®å¤„ç†
> except OutputParserException as e:
>     if e.recoverable:
>         retry()
> ```

---

## 9. ã€åŒ–éª¨ç»µæŒã€‘

### å¡ç‰‡1ï¼šä»€ä¹ˆæ˜¯å¼‚å¸¸ ğŸ¯

**ä¸€å¥è¯ï¼š** å¼‚å¸¸æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„"æ„å¤–äº‹ä»¶"ï¼Œè¡¨ç¤ºæ­£å¸¸æµç¨‹è¢«æ‰“æ–­ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# è¿™äº›éƒ½ä¼šäº§ç”Ÿå¼‚å¸¸
10 / 0               # ZeroDivisionError
int("abc")           # ValueError
my_list[100]         # IndexError
open("ä¸å­˜åœ¨.txt")   # FileNotFoundError
```

**åº”ç”¨ï¼š** LangChain ä¸­ API è°ƒç”¨è¶…æ—¶ã€JSON è§£æå¤±è´¥éƒ½æ˜¯å¼‚å¸¸ã€‚

---

### å¡ç‰‡2ï¼štry-except åŸºç¡€ ğŸ“

**ä¸€å¥è¯ï¼š** `try` åŒ…è£¹å¯èƒ½å‡ºé”™çš„ä»£ç ï¼Œ`except` å¤„ç†é”™è¯¯ã€‚

**ä¸¾ä¾‹ï¼š**
```python
try:
    result = risky_operation()
except Exception as e:
    print(f"å‡ºé”™äº†: {e}")
    result = default_value
```

**åº”ç”¨ï¼š** è°ƒç”¨ LLM API æ—¶ï¼Œç”¨ try-except å¤„ç†ç½‘ç»œé”™è¯¯ã€è¶…æ—¶ç­‰ã€‚

---

### å¡ç‰‡3ï¼šæ•è·ç‰¹å®šå¼‚å¸¸ ğŸ¯

**ä¸€å¥è¯ï¼š** å°½é‡æ•è·å…·ä½“çš„å¼‚å¸¸ç±»å‹ï¼Œè€Œä¸æ˜¯ç¬¼ç»Ÿçš„ `Exception`ã€‚

**ä¸¾ä¾‹ï¼š**
```python
try:
    data = json.loads(text)
except json.JSONDecodeError:
    print("JSON æ ¼å¼é”™è¯¯")
except ValueError:
    print("å€¼é”™è¯¯")
```

**åº”ç”¨ï¼š** LangChain åŒºåˆ† `OutputParserException` å’Œ `LLMException` åˆ†åˆ«å¤„ç†ã€‚

---

### å¡ç‰‡4ï¼šå¤šä¸ª except å— ğŸ”§

**ä¸€å¥è¯ï¼š** å¯ä»¥æœ‰å¤šä¸ª `except` å¤„ç†ä¸åŒç±»å‹çš„å¼‚å¸¸ï¼Œé¡ºåºå¾ˆé‡è¦ã€‚

**ä¸¾ä¾‹ï¼š**
```python
try:
    process()
except ValueError:      # å…ˆæ•è·å…·ä½“çš„
    handle_value_error()
except TypeError:       # å†æ•è·å…·ä½“çš„
    handle_type_error()
except Exception:       # æœ€åæ˜¯å…œåº•
    handle_other()
```

**åº”ç”¨ï¼š** å¤„ç† LLM å“åº”æ—¶ï¼Œåˆ†åˆ«å¤„ç†ç½‘ç»œé”™è¯¯ã€è§£æé”™è¯¯ã€éªŒè¯é”™è¯¯ã€‚

---

### å¡ç‰‡5ï¼šelse å’Œ finally âš¡

**ä¸€å¥è¯ï¼š** `else` åœ¨æ— å¼‚å¸¸æ—¶æ‰§è¡Œï¼Œ`finally` æ— è®ºå¦‚ä½•éƒ½æ‰§è¡Œã€‚

**ä¸¾ä¾‹ï¼š**
```python
try:
    data = fetch_data()
except NetworkError:
    data = cache_data
else:
    print("æˆåŠŸè·å–æ–°æ•°æ®")  # åªæœ‰æˆåŠŸæ—¶
finally:
    close_connection()      # æ— è®ºå¦‚ä½•éƒ½å…³é—­è¿æ¥
```

**åº”ç”¨ï¼š** ç¡®ä¿ API è¿æ¥ã€æ–‡ä»¶å¥æŸ„ç­‰èµ„æºæ­£ç¡®é‡Šæ”¾ã€‚

---

### å¡ç‰‡6ï¼šraise æŠ›å‡ºå¼‚å¸¸ ğŸš€

**ä¸€å¥è¯ï¼š** `raise` ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥æ˜¯æ–°å¼‚å¸¸æˆ–é‡æ–°æŠ›å‡ºå½“å‰å¼‚å¸¸ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# æŠ›å‡ºæ–°å¼‚å¸¸
if value < 0:
    raise ValueError("å€¼ä¸èƒ½ä¸ºè´Ÿ")

# é‡æ–°æŠ›å‡ºå½“å‰å¼‚å¸¸
try:
    process()
except Exception:
    log_error()
    raise  # è®°å½•åç»§ç»­æŠ›å‡º
```

**åº”ç”¨ï¼š** LangChain çš„ `OutputParser` åœ¨è§£æå¤±è´¥æ—¶æŠ›å‡º `OutputParserException`ã€‚

---

### å¡ç‰‡7ï¼šè‡ªå®šä¹‰å¼‚å¸¸ç±» ğŸ—ï¸

**ä¸€å¥è¯ï¼š** ç»§æ‰¿ `Exception` åˆ›å»ºè‡ªå·±çš„å¼‚å¸¸ç±»å‹ï¼Œæºå¸¦æ›´å¤šä¿¡æ¯ã€‚

**ä¸¾ä¾‹ï¼š**
```python
class APIError(Exception):
    def __init__(self, status_code, message):
        self.status_code = status_code
        super().__init__(f"[{status_code}] {message}")

raise APIError(429, "é€Ÿç‡é™åˆ¶")
```

**åº”ç”¨ï¼š** LangChain å®šä¹‰ `OutputParserException` æºå¸¦ `llm_output` å’Œ `recoverable` å±æ€§ã€‚

---

### å¡ç‰‡8ï¼šå¼‚å¸¸é“¾ raise from ğŸ”—

**ä¸€å¥è¯ï¼š** `raise ... from e` ä¿ç•™åŸå§‹å¼‚å¸¸ï¼Œå½¢æˆå¼‚å¸¸é“¾ã€‚

**ä¸¾ä¾‹ï¼š**
```python
try:
    data = json.loads(text)
except json.JSONDecodeError as e:
    raise ParseError("è§£æå¤±è´¥") from e
    # e.__cause__ å¯ä»¥è®¿é—®åŸå§‹å¼‚å¸¸
```

**åº”ç”¨ï¼š** è°ƒè¯•æ—¶å¯ä»¥è¿½æº¯é”™è¯¯çš„æ ¹æœ¬åŸå› ï¼Œè€Œä¸åªæ˜¯çœ‹åˆ°æœ€å¤–å±‚å¼‚å¸¸ã€‚

---

### å¡ç‰‡9ï¼šä¸Šä¸‹æ–‡ç®¡ç†å™¨ with ğŸ“¦

**ä¸€å¥è¯ï¼š** `with` è¯­å¥è‡ªåŠ¨ç®¡ç†èµ„æºçš„è·å–å’Œé‡Šæ”¾ï¼Œå³ä½¿å‡ºé”™ä¹Ÿä¼šæ¸…ç†ã€‚

**ä¸¾ä¾‹ï¼š**
```python
with open("file.txt") as f:
    content = f.read()
# è‡ªåŠ¨å…³é—­æ–‡ä»¶

# è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ç®¡ç†å™¨
class Connection:
    def __enter__(self):
        return self.connect()
    def __exit__(self, *args):
        self.disconnect()
```

**åº”ç”¨ï¼š** LangChain çš„å›è°ƒç®¡ç†ã€è¿½è¸ªç³»ç»Ÿéƒ½ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚

---

### å¡ç‰‡10ï¼šLangChain ä¸­çš„å¼‚å¸¸å¤„ç† â­

**ä¸€å¥è¯ï¼š** LangChain é€šè¿‡è‡ªå®šä¹‰å¼‚å¸¸ + é‡è¯•æœºåˆ¶ + é™çº§ç­–ç•¥æ„å»ºå¥å£®åº”ç”¨ã€‚

**æ ¸å¿ƒæ¨¡å¼ï¼š**
```python
# 1. è‡ªå®šä¹‰å¼‚å¸¸
class OutputParserException(Exception):
    llm_output: str
    recoverable: bool

# 2. é‡è¯•æœºåˆ¶
chain_with_retry = chain.with_retry(max_attempts=3)

# 3. é™çº§ç­–ç•¥
robust_chain = main_chain.with_fallback(backup_chain)

# 4. ä½¿ç”¨
try:
    result = robust_chain.invoke(input)
except OutputParserException as e:
    if e.recoverable:
        result = handle_recovery(e)
```

**åº”ç”¨ï¼š** ç†è§£è¿™äº›æ¨¡å¼ï¼Œå°±èƒ½æ„å»ºç¨³å®šçš„ LLM åº”ç”¨ï¼Œä¼˜é›…å¤„ç†å„ç§å¤±è´¥åœºæ™¯ã€‚

---

## 10. ã€ä¸€å¥è¯æ€»ç»“ã€‘

**å¼‚å¸¸å¤„ç†æ˜¯ Python æ•è·å’Œå“åº”è¿è¡Œæ—¶é”™è¯¯çš„æœºåˆ¶ï¼Œé€šè¿‡ try-except-else-finally ç»“æ„ã€è‡ªå®šä¹‰å¼‚å¸¸ã€å¼‚å¸¸é“¾å’Œä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ç°ç¨‹åºçš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæ˜¯ LangChain ä¸­å¤„ç† API è°ƒç”¨å¤±è´¥ã€æ•°æ®è§£æé”™è¯¯ã€å®ç°é‡è¯•å’Œé™çº§ç­–ç•¥çš„æ ¸å¿ƒåŸºç¡€ã€‚**

---

## ğŸ“š å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£ä»€ä¹ˆæ˜¯å¼‚å¸¸ä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å¼‚å¸¸å¤„ç†
- [ ] ä¼šä½¿ç”¨ try-except æ•è·å¼‚å¸¸
- [ ] ç†è§£ else å’Œ finally çš„ä½œç”¨
- [ ] ä¼šä½¿ç”¨ raise æŠ›å‡ºå¼‚å¸¸
- [ ] èƒ½å¤Ÿåˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»
- [ ] ç†è§£å¼‚å¸¸å±‚æ¬¡ç»“æ„å’Œæ•è·é¡ºåº
- [ ] ä¼šä½¿ç”¨ raise ... from ä¿ç•™å¼‚å¸¸é“¾
- [ ] ä¼šä½¿ç”¨ with è¯­å¥ç®¡ç†èµ„æº
- [ ] ç†è§£ä»€ä¹ˆæ—¶å€™è¯¥æ•è·ã€ä»€ä¹ˆæ—¶å€™è¯¥ä¼ æ’­å¼‚å¸¸
- [ ] èƒ½å¤Ÿé˜…è¯» LangChain æºç ä¸­çš„å¼‚å¸¸å¤„ç†é€»è¾‘

## ğŸ”— ä¸‹ä¸€æ­¥å­¦ä¹ 

- **Pydantic æ•°æ®éªŒè¯**ï¼šæ›´å¼ºå¤§çš„æ•°æ®éªŒè¯å’Œå¼‚å¸¸å¤„ç†
- **å¼‚æ­¥ç¼–ç¨‹ async/await**ï¼šå¼‚æ­¥ä»£ç ä¸­çš„å¼‚å¸¸å¤„ç†
- **Runnable åè®®**ï¼šLangChain æ ¸å¿ƒç»„ä»¶çš„é”™è¯¯å¤„ç†æœºåˆ¶

---

**ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2025-12-12
