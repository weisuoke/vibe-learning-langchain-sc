# æ¨¡å—ä¸åŒ…ç³»ç»Ÿ

> åŸå­åŒ–çŸ¥è¯†ç‚¹ | PythonåŸºç¡€ | LangChain æºç å­¦ä¹ å‰ç½®çŸ¥è¯†

---

## 1. ã€30å­—æ ¸å¿ƒã€‘

**æ¨¡å—æ˜¯ `.py` æ–‡ä»¶ï¼ŒåŒ…æ˜¯å« `__init__.py` çš„æ–‡ä»¶å¤¹ï¼Œå®ƒä»¬æ˜¯ Python ä»£ç ç»„ç»‡çš„åŸºçŸ³ï¼Œç†è§£å®ƒä»¬æ‰èƒ½è¯»æ‡‚ LangChain æºç ç»“æ„ã€‚**

---

## 2. ã€ç¬¬ä¸€æ€§åŸç†ã€‘

### ä»€ä¹ˆæ˜¯ç¬¬ä¸€æ€§åŸç†ï¼Ÿ

**ç¬¬ä¸€æ€§åŸç†**ï¼šå›åˆ°äº‹ç‰©æœ€åŸºæœ¬çš„çœŸç†ï¼Œä»æºå¤´æ€è€ƒé—®é¢˜

### æ¨¡å—ä¸åŒ…çš„ç¬¬ä¸€æ€§åŸç† ğŸ¯

#### 1. æœ€åŸºç¡€çš„å®šä¹‰

**æ¨¡å— = ä¸€ä¸ª `.py` æ–‡ä»¶**
**åŒ… = ä¸€ä¸ªåŒ…å« `__init__.py` çš„æ–‡ä»¶å¤¹**

ä»…æ­¤è€Œå·²ï¼æ²¡æœ‰æ›´åŸºç¡€çš„äº†ã€‚

- **æ¨¡å—**ï¼šä¸€ä¸ª Python æºä»£ç æ–‡ä»¶ï¼Œå¯ä»¥åŒ…å«å˜é‡ã€å‡½æ•°ã€ç±»
- **åŒ…**ï¼šä¸€ä¸ªç»„ç»‡æ¨¡å—çš„æ–‡ä»¶å¤¹ï¼Œç”¨äºåˆ›å»ºå±‚æ¬¡åŒ–çš„å‘½åç©ºé—´

#### 2. ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—ä¸åŒ…ï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•ç»„ç»‡è¶Šæ¥è¶Šå¤šçš„ä»£ç ï¼Ÿ**

```python
# æƒ³è±¡æ‰€æœ‰ä»£ç éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œ...
# main.py (10000è¡Œ)

# æ¶ˆæ¯ç›¸å…³ä»£ç 
class BaseMessage: ...
class HumanMessage: ...
class AIMessage: ...

# LLM ç›¸å…³ä»£ç 
class BaseLLM: ...
class ChatOpenAI: ...
class ChatAnthropic: ...

# Runnable ç›¸å…³ä»£ç 
class Runnable: ...
class RunnableSequence: ...
class RunnableLambda: ...

# æç¤ºè¯ç›¸å…³ä»£ç 
class PromptTemplate: ...
class ChatPromptTemplate: ...

# é—®é¢˜ï¼š
# 1. æ‰¾ä»£ç å¤ªéš¾äº†ï¼Message åœ¨å“ªï¼Ÿè¦ç¿»å¾ˆä¹…
# 2. å›¢é˜Ÿåä½œä¼šå†²çª - æ¯ä¸ªäººéƒ½åœ¨æ”¹åŒä¸€ä¸ªæ–‡ä»¶
# 3. æµ‹è¯•å’Œç»´æŠ¤å›°éš¾ - æ”¹ä¸€ä¸ªåœ°æ–¹å¯èƒ½å½±å“å…¶ä»–
# 4. å¤ç”¨å›°éš¾ - æƒ³åªç”¨ Message ç±»ï¼Ÿå¿…é¡»åŠ è½½æ•´ä¸ªæ–‡ä»¶
```

```python
# ä½¿ç”¨æ¨¡å—ä¸åŒ…ç»„ç»‡å
# langchain_core/
# â”œâ”€â”€ __init__.py
# â”œâ”€â”€ messages/
# â”‚   â”œâ”€â”€ __init__.py
# â”‚   â”œâ”€â”€ base.py      # BaseMessage
# â”‚   â”œâ”€â”€ human.py     # HumanMessage
# â”‚   â””â”€â”€ ai.py        # AIMessage
# â”œâ”€â”€ language_models/
# â”‚   â”œâ”€â”€ __init__.py
# â”‚   â”œâ”€â”€ base.py      # BaseLLM
# â”‚   â””â”€â”€ chat_models.py
# â””â”€â”€ runnables/
#     â”œâ”€â”€ __init__.py
#     â”œâ”€â”€ base.py      # Runnable
#     â””â”€â”€ sequence.py  # RunnableSequence

# ä¼˜åŠ¿ï¼š
# 1. ç»“æ„æ¸…æ™° - çœ‹æ–‡ä»¶å¤¹å°±çŸ¥é“æœ‰ä»€ä¹ˆ
# 2. å›¢é˜Ÿåä½œ - ä¸åŒäººè´Ÿè´£ä¸åŒæ¨¡å—
# 3. ç‹¬ç«‹æµ‹è¯• - æ¯ä¸ªæ¨¡å—å¯ä»¥å•ç‹¬æµ‹è¯•
# 4. æŒ‰éœ€åŠ è½½ - from langchain_core.messages import HumanMessage
```

#### 3. æ¨¡å—ä¸åŒ…çš„ä¸‰å±‚ä»·å€¼

##### ä»·å€¼1ï¼šä»£ç å¤ç”¨ - å†™ä¸€æ¬¡ï¼Œåˆ°å¤„ç”¨

```python
# utils.py
def format_message(content: str) -> str:
    return content.strip().capitalize()

# main.py
from utils import format_message  # å¤ç”¨ï¼

# another_file.py
from utils import format_message  # å†æ¬¡å¤ç”¨ï¼
```

##### ä»·å€¼2ï¼šå‘½åç©ºé—´éš”ç¦» - é¿å…åå­—å†²çª

```python
# ä¸¤ä¸ªæ¨¡å—å¯ä»¥æœ‰åŒåçš„ç±»
# langchain_core/messages/base.py
class BaseMessage: ...

# langchain_core/prompts/base.py
class BaseMessage: ...  # ä¸å†²çªï¼å‘½åç©ºé—´ä¸åŒ

# ä½¿ç”¨æ—¶é€šè¿‡è·¯å¾„åŒºåˆ†
from langchain_core.messages.base import BaseMessage as MessageBase
from langchain_core.prompts.base import BaseMessage as PromptBase
```

##### ä»·å€¼3ï¼šå°è£…ä¸éšè— - åªæš´éœ²å…¬å¼€ API

```python
# langchain_core/messages/__init__.py
from .base import BaseMessage
from .human import HumanMessage
from .ai import AIMessage

__all__ = ["BaseMessage", "HumanMessage", "AIMessage"]  # å…¬å¼€ API

# å†…éƒ¨å®ç°ç»†èŠ‚ä¸æš´éœ²
# _internal_helper() ä¸ä¼šå‡ºç°åœ¨ __all__ ä¸­
```

#### 4. ä»ç¬¬ä¸€æ€§åŸç†æ¨å¯¼ LangChain æºç ç»“æ„

**æ¨ç†é“¾ï¼š**

```
1. LangChain æ˜¯ä¸€ä¸ªå¤§å‹ LLM åº”ç”¨æ¡†æ¶
   â†“
2. éœ€è¦ç»„ç»‡å¤§é‡ä»£ç ï¼ˆæ¶ˆæ¯ã€æ¨¡å‹ã€Runnableã€æç¤ºè¯...ï¼‰
   â†“
3. ä¸åŒåŠŸèƒ½åº”è¯¥åˆ†å¼€ç®¡ç†ï¼ˆå…³æ³¨ç‚¹åˆ†ç¦»ï¼‰
   â†“
4. ä½¿ç”¨åŒ…æ¥ç»„ç»‡ä¸åŒåŠŸèƒ½æ¨¡å—
   â†“
5. langchain-core/ ä½œä¸ºæ ¸å¿ƒåŒ…
   â†“
6. æ¯ä¸ªåŠŸèƒ½ä¸€ä¸ªå­åŒ…ï¼ˆmessages/, runnables/, prompts/...ï¼‰
   â†“
7. __init__.py æ§åˆ¶å…¬å¼€ API
   â†“
8. ç”¨æˆ·åªéœ€è¦ from langchain_core.messages import HumanMessage
```

#### 5. ä¸€å¥è¯æ€»ç»“ç¬¬ä¸€æ€§åŸç†

**æ¨¡å—ä¸åŒ…æ˜¯ Python ä»£ç ç»„ç»‡çš„åŸºæœ¬å•ä½ï¼Œé€šè¿‡æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„å±‚æ¬¡ç»“æ„å®ç°ä»£ç å¤ç”¨ã€å‘½åç©ºé—´éš”ç¦»å’Œ API å°è£…ï¼Œæ˜¯æ„å»ºå¤§å‹é¡¹ç›®ï¼ˆå¦‚ LangChainï¼‰çš„åŸºç¡€ã€‚**

---

## 3. ã€æ ¸å¿ƒæ¦‚å¿µï¼ˆå…¨é¢è¦†ç›–ï¼‰ã€‘

### æ ¸å¿ƒæ¦‚å¿µ1ï¼šæ¨¡å— (Module) ğŸ“„

**æ¨¡å—å°±æ˜¯ä¸€ä¸ª `.py` æ–‡ä»¶ï¼Œæ˜¯ Python ä»£ç ç»„ç»‡çš„åŸºæœ¬å•ä½**

```python
# === åˆ›å»ºæ¨¡å—ï¼šmath_utils.py ===
"""æ•°å­¦å·¥å…·æ¨¡å— - è¿™æ˜¯æ¨¡å—æ–‡æ¡£å­—ç¬¦ä¸²"""

PI = 3.14159  # æ¨¡å—çº§å˜é‡

def circle_area(radius: float) -> float:
    """è®¡ç®—åœ†çš„é¢ç§¯"""
    return PI * radius ** 2

def circle_perimeter(radius: float) -> float:
    """è®¡ç®—åœ†çš„å‘¨é•¿"""
    return 2 * PI * radius

class Circle:
    """åœ†å½¢ç±»"""
    def __init__(self, radius: float):
        self.radius = radius

    def area(self) -> float:
        return circle_area(self.radius)

# æ¨¡å—è¢«ç›´æ¥è¿è¡Œæ—¶æ‰æ‰§è¡Œ
if __name__ == "__main__":
    print(f"æµ‹è¯•ï¼šåŠå¾„ä¸º2çš„åœ†é¢ç§¯ = {circle_area(2)}")
```

```python
# === ä½¿ç”¨æ¨¡å—ï¼šmain.py ===

# æ–¹å¼1ï¼šå¯¼å…¥æ•´ä¸ªæ¨¡å—
import math_utils
print(math_utils.PI)                    # 3.14159
print(math_utils.circle_area(2))        # 12.56636

# æ–¹å¼2ï¼šå¯¼å…¥ç‰¹å®šå†…å®¹
from math_utils import PI, circle_area
print(PI)                               # 3.14159
print(circle_area(2))                   # 12.56636

# æ–¹å¼3ï¼šå¯¼å…¥å¹¶é‡å‘½åï¼ˆåˆ«åï¼‰
from math_utils import circle_area as area
print(area(2))                          # 12.56636

# æ–¹å¼4ï¼šå¯¼å…¥æ‰€æœ‰å…¬å¼€å†…å®¹ï¼ˆä¸æ¨èï¼‰
from math_utils import *
print(PI)                               # å¯ç”¨ï¼Œä½†ä¸æ¨è
```

**æ¨¡å—çš„ç‰¹æ®Šå±æ€§ï¼š**

| å±æ€§ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `__name__` | æ¨¡å—åç§° | `"math_utils"` æˆ– `"__main__"` |
| `__file__` | æ¨¡å—æ–‡ä»¶è·¯å¾„ | `"/path/to/math_utils.py"` |
| `__doc__` | æ¨¡å—æ–‡æ¡£å­—ç¬¦ä¸² | `"æ•°å­¦å·¥å…·æ¨¡å—..."` |
| `__all__` | å…¬å¼€ API åˆ—è¡¨ | `["PI", "circle_area"]` |

**`__name__` çš„å¦™ç”¨ï¼š**

```python
# math_utils.py
def main():
    """æ¨¡å—ä¸»å‡½æ•°"""
    print("ç›´æ¥è¿è¡Œ math_utils.py")

if __name__ == "__main__":
    # åªæœ‰ç›´æ¥è¿è¡Œè¿™ä¸ªæ–‡ä»¶æ—¶æ‰æ‰§è¡Œ
    # è¢« import æ—¶ä¸æ‰§è¡Œ
    main()

# è¿è¡Œæ–¹å¼ï¼š
# python math_utils.py    â†’ æ‰§è¡Œ main()ï¼Œ__name__ == "__main__"
# import math_utils       â†’ ä¸æ‰§è¡Œ main()ï¼Œ__name__ == "math_utils"
```

**åœ¨ LangChain æºç ä¸­çš„åº”ç”¨ï¼š**

```python
# langchain_core/messages/base.py
"""Base class for messages."""

from abc import ABC, abstractmethod
from typing import Any, Dict, List, Optional

class BaseMessage(ABC):
    """æ‰€æœ‰æ¶ˆæ¯çš„åŸºç±»"""
    content: str
    type: str = "base"

    @property
    @abstractmethod
    def type(self) -> str:
        """æ¶ˆæ¯ç±»å‹"""
        pass

# è¿™å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼åŒ…å«ç±»ã€å‡½æ•°ã€å˜é‡
```

---

### æ ¸å¿ƒæ¦‚å¿µ2ï¼šåŒ… (Package) ğŸ“

**åŒ…æ˜¯ä¸€ä¸ªåŒ…å« `__init__.py` çš„æ–‡ä»¶å¤¹ï¼Œç”¨äºç»„ç»‡ç›¸å…³æ¨¡å—**

```
# åŒ…çš„ç»“æ„
my_package/
â”œâ”€â”€ __init__.py      # å¿…é¡»æœ‰ï¼æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªåŒ…
â”œâ”€â”€ module_a.py      # å­æ¨¡å—
â”œâ”€â”€ module_b.py      # å­æ¨¡å—
â””â”€â”€ subpackage/      # å­åŒ…
    â”œâ”€â”€ __init__.py  # å­åŒ…ä¹Ÿéœ€è¦ __init__.py
    â””â”€â”€ module_c.py  # å­åŒ…ä¸­çš„æ¨¡å—
```

**åˆ›å»ºåŒ…çš„æ­¥éª¤ï¼š**

```python
# 1. åˆ›å»ºæ–‡ä»¶å¤¹ç»“æ„
# my_llm_package/
# â”œâ”€â”€ __init__.py
# â”œâ”€â”€ models.py
# â””â”€â”€ utils.py

# === my_llm_package/models.py ===
class BaseLLM:
    def invoke(self, prompt: str) -> str:
        raise NotImplementedError

class FakeLLM(BaseLLM):
    def invoke(self, prompt: str) -> str:
        return f"Response to: {prompt}"

# === my_llm_package/utils.py ===
def format_prompt(template: str, **kwargs) -> str:
    return template.format(**kwargs)

# === my_llm_package/__init__.py ===
"""æˆ‘çš„ LLM åŒ…"""
from .models import BaseLLM, FakeLLM
from .utils import format_prompt

__version__ = "1.0.0"
__all__ = ["BaseLLM", "FakeLLM", "format_prompt"]
```

```python
# === ä½¿ç”¨åŒ…ï¼šmain.py ===

# æ–¹å¼1ï¼šä»åŒ…å¯¼å…¥
from my_llm_package import FakeLLM, format_prompt

llm = FakeLLM()
print(llm.invoke("Hello"))

# æ–¹å¼2ï¼šä»å­æ¨¡å—å¯¼å…¥
from my_llm_package.models import BaseLLM

# æ–¹å¼3ï¼šå¯¼å…¥æ•´ä¸ªåŒ…
import my_llm_package
print(my_llm_package.__version__)  # "1.0.0"
```

**`__init__.py` çš„ä½œç”¨ï¼š**

1. **æ ‡è¯†åŒ…**ï¼šå‘Šè¯‰ Python è¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ªåŒ…
2. **åˆå§‹åŒ–ä»£ç **ï¼šåŒ…è¢«å¯¼å…¥æ—¶æ‰§è¡Œ
3. **æ§åˆ¶å¯¼å‡º**ï¼šé€šè¿‡ `__all__` å®šä¹‰å…¬å¼€ API
4. **ç®€åŒ–å¯¼å…¥**ï¼šé‡æ–°å¯¼å‡ºå­æ¨¡å—å†…å®¹

```python
# langchain_core/messages/__init__.py
"""LangChain æ¶ˆæ¯æ¨¡å—"""

# ä»å­æ¨¡å—é‡æ–°å¯¼å‡ºï¼Œç®€åŒ–ç”¨æˆ·å¯¼å…¥è·¯å¾„
from langchain_core.messages.base import BaseMessage
from langchain_core.messages.human import HumanMessage
from langchain_core.messages.ai import AIMessage
from langchain_core.messages.system import SystemMessage

# å®šä¹‰å…¬å¼€ API
__all__ = [
    "BaseMessage",
    "HumanMessage",
    "AIMessage",
    "SystemMessage",
]

# ç”¨æˆ·å¯ä»¥ç›´æ¥ï¼š
# from langchain_core.messages import HumanMessage
# è€Œä¸éœ€è¦ï¼š
# from langchain_core.messages.human import HumanMessage
```

**åœ¨ LangChain æºç ä¸­çš„åº”ç”¨ï¼š**

```
# LangChain æ ¸å¿ƒåŒ…ç»“æ„
langchain-core/
â””â”€â”€ langchain_core/
    â”œâ”€â”€ __init__.py              # é¡¶å±‚åŒ…
    â”œâ”€â”€ messages/                 # æ¶ˆæ¯å­åŒ…
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ base.py
    â”‚   â”œâ”€â”€ human.py
    â”‚   â””â”€â”€ ai.py
    â”œâ”€â”€ runnables/               # Runnable å­åŒ…
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ base.py
    â”‚   â”œâ”€â”€ config.py
    â”‚   â””â”€â”€ passthrough.py
    â”œâ”€â”€ prompts/                 # æç¤ºè¯å­åŒ…
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ base.py
    â”‚   â””â”€â”€ chat.py
    â””â”€â”€ language_models/         # è¯­è¨€æ¨¡å‹å­åŒ…
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ base.py
        â””â”€â”€ chat_models.py
```

---

### æ ¸å¿ƒæ¦‚å¿µ3ï¼šå¯¼å…¥ç³»ç»Ÿ (Import System) ğŸ”„

**Python çš„å¯¼å…¥ç³»ç»Ÿè´Ÿè´£æŸ¥æ‰¾ã€åŠ è½½å’Œæ‰§è¡Œæ¨¡å—**

**ç»å¯¹å¯¼å…¥ vs ç›¸å¯¹å¯¼å…¥ï¼š**

```python
# é¡¹ç›®ç»“æ„
# project/
# â”œâ”€â”€ main.py
# â””â”€â”€ my_package/
#     â”œâ”€â”€ __init__.py
#     â”œâ”€â”€ module_a.py
#     â””â”€â”€ subpackage/
#         â”œâ”€â”€ __init__.py
#         â””â”€â”€ module_b.py

# === ç»å¯¹å¯¼å…¥ï¼ˆæ¨èï¼‰===
# ä»é¡¹ç›®æ ¹ç›®å½•å¼€å§‹çš„å®Œæ•´è·¯å¾„
from my_package.module_a import SomeClass
from my_package.subpackage.module_b import AnotherClass

# === ç›¸å¯¹å¯¼å…¥ ===
# åœ¨åŒ…å†…éƒ¨ä½¿ç”¨ï¼Œç›¸å¯¹äºå½“å‰æ¨¡å—ä½ç½®
# . è¡¨ç¤ºå½“å‰åŒ…
# .. è¡¨ç¤ºçˆ¶åŒ…

# åœ¨ my_package/subpackage/module_b.py ä¸­
from . import some_function           # ä»å½“å‰åŒ…å¯¼å…¥
from .. import module_a               # ä»çˆ¶åŒ…å¯¼å…¥
from ..module_a import SomeClass      # ä»çˆ¶åŒ…çš„æ¨¡å—å¯¼å…¥
```

**ç›¸å¯¹å¯¼å…¥è¯­æ³•ï¼š**

| è¯­æ³• | å«ä¹‰ | ç­‰ä»·ç»å¯¹å¯¼å…¥ |
|------|------|-------------|
| `from . import x` | ä»å½“å‰åŒ…å¯¼å…¥ | `from current_package import x` |
| `from .module import x` | ä»å½“å‰åŒ…çš„æ¨¡å—å¯¼å…¥ | `from current_package.module import x` |
| `from .. import x` | ä»çˆ¶åŒ…å¯¼å…¥ | `from parent_package import x` |
| `from ..sibling import x` | ä»å…„å¼ŸåŒ…å¯¼å…¥ | `from parent_package.sibling import x` |

**æ¨¡å—æœç´¢è·¯å¾„ `sys.path`ï¼š**

```python
import sys

# æŸ¥çœ‹æ¨¡å—æœç´¢è·¯å¾„
print(sys.path)
# [
#     '',                              # å½“å‰ç›®å½•
#     '/usr/lib/python3.10',           # æ ‡å‡†åº“
#     '/usr/lib/python3.10/site-packages',  # ç¬¬ä¸‰æ–¹åŒ…
#     ...
# ]

# æ·»åŠ è‡ªå®šä¹‰è·¯å¾„
sys.path.insert(0, '/path/to/my/modules')

# Python æŒ‰é¡ºåºæœç´¢è¿™äº›è·¯å¾„æ¥æ‰¾æ¨¡å—
```

**å¯¼å…¥æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼š**

```python
import my_module

# 1. æ£€æŸ¥ sys.modules ç¼“å­˜ï¼ˆæ˜¯å¦å·²å¯¼å…¥ï¼‰
# 2. åœ¨ sys.path ä¸­æœç´¢æ¨¡å—
# 3. æ‰¾åˆ°ååŠ è½½å¹¶æ‰§è¡Œæ¨¡å—ä»£ç 
# 4. åˆ›å»ºæ¨¡å—å¯¹è±¡å¹¶åŠ å…¥ sys.modules ç¼“å­˜
# 5. å°†æ¨¡å—ç»‘å®šåˆ°å½“å‰å‘½åç©ºé—´
```

**åœ¨ LangChain æºç ä¸­çš„åº”ç”¨ï¼š**

```python
# langchain_core/runnables/base.py
# ä½¿ç”¨ç»å¯¹å¯¼å…¥
from langchain_core.runnables.config import RunnableConfig
from langchain_core.runnables.utils import Input, Output

# ä¹Ÿå¯ä»¥ç”¨ç›¸å¯¹å¯¼å…¥ï¼ˆåŒ…å†…éƒ¨ï¼‰
from .config import RunnableConfig
from .utils import Input, Output
```

---

### æ‰©å±•æ¦‚å¿µ4ï¼š`__all__` å’Œå…¬å¼€ API æ§åˆ¶ ğŸ¯

```python
# my_module.py

# å†…éƒ¨ä½¿ç”¨çš„å‡½æ•°ï¼ˆä¸æƒ³æš´éœ²ï¼‰
def _internal_helper():
    return "å†…éƒ¨ä½¿ç”¨"

# å…¬å¼€ API
def public_function():
    return _internal_helper() + " - å…¬å¼€"

class PublicClass:
    pass

class _InternalClass:
    pass

# å®šä¹‰å…¬å¼€ API
__all__ = ["public_function", "PublicClass"]

# æ•ˆæœï¼š
# from my_module import *  åªä¼šå¯¼å…¥ __all__ ä¸­çš„å†…å®¹
# public_function å’Œ PublicClass ä¼šè¢«å¯¼å…¥
# _internal_helper å’Œ _InternalClass ä¸ä¼šè¢«å¯¼å…¥
```

**`__all__` çš„ä½œç”¨ï¼š**

1. **æ§åˆ¶ `import *`**ï¼šåªå¯¼å‡ºåˆ—è¡¨ä¸­çš„åç§°
2. **æ–‡æ¡£ä½œç”¨**ï¼šæ˜ç¡®å‘Šè¯‰ç”¨æˆ·å“ªäº›æ˜¯å…¬å¼€ API
3. **IDE æ”¯æŒ**ï¼šå¸®åŠ© IDE æä¾›æ›´å¥½çš„è‡ªåŠ¨è¡¥å…¨

```python
# langchain_core/runnables/__init__.py
from langchain_core.runnables.base import (
    Runnable,
    RunnableSequence,
    RunnableParallel,
    RunnableLambda,
)
from langchain_core.runnables.config import RunnableConfig
from langchain_core.runnables.passthrough import RunnablePassthrough

__all__ = [
    "Runnable",
    "RunnableSequence",
    "RunnableParallel",
    "RunnableLambda",
    "RunnableConfig",
    "RunnablePassthrough",
]

# ç”¨æˆ·ä½¿ç”¨ï¼š
# from langchain_core.runnables import Runnable  âœ… æ¨è
# from langchain_core.runnables import *         âœ… åªå¯¼å…¥ __all__ ä¸­çš„
```

---

### æ‰©å±•æ¦‚å¿µ5ï¼šå¾ªç¯å¯¼å…¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ ğŸ”„

**ä»€ä¹ˆæ˜¯å¾ªç¯å¯¼å…¥ï¼š**

```python
# é—®é¢˜åœºæ™¯
# module_a.py
from module_b import function_b  # å¯¼å…¥ module_b

def function_a():
    return function_b() + " from A"

# module_b.py
from module_a import function_a  # å¯¼å…¥ module_aï¼ˆå¾ªç¯ï¼ï¼‰

def function_b():
    return function_a() + " from B"

# è¿è¡Œæ—¶æŠ¥é”™ï¼šImportError: cannot import name 'function_a'
```

**è§£å†³æ–¹æ¡ˆï¼š**

```python
# æ–¹æ¡ˆ1ï¼šå»¶è¿Ÿå¯¼å…¥ï¼ˆåœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥ï¼‰
# module_a.py
def function_a():
    from module_b import function_b  # å»¶è¿Ÿå¯¼å…¥
    return function_b() + " from A"

# module_b.py
def function_b():
    from module_a import function_a  # å»¶è¿Ÿå¯¼å…¥
    return function_a() + " from B"
```

```python
# æ–¹æ¡ˆ2ï¼šé‡æ„ä»£ç ç»“æ„ï¼ˆæ¨èï¼‰
# å°†å…±åŒä¾èµ–æå–åˆ°ç¬¬ä¸‰ä¸ªæ¨¡å—

# common.py
class BaseClass:
    pass

# module_a.py
from common import BaseClass
class ClassA(BaseClass):
    pass

# module_b.py
from common import BaseClass
class ClassB(BaseClass):
    pass
```

```python
# æ–¹æ¡ˆ3ï¼šä½¿ç”¨ TYPE_CHECKINGï¼ˆç±»å‹æ³¨è§£ç”¨ï¼‰
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    # è¿™éƒ¨åˆ†åªåœ¨ç±»å‹æ£€æŸ¥æ—¶æ‰§è¡Œï¼Œè¿è¡Œæ—¶ä¸æ‰§è¡Œ
    from module_b import ClassB

class ClassA:
    def method(self, b: "ClassB") -> None:  # ä½¿ç”¨å­—ç¬¦ä¸²æ³¨è§£
        pass
```

**LangChain ä¸­çš„å®è·µï¼š**

```python
# langchain_core/runnables/base.py
from __future__ import annotations  # å¯ç”¨å»¶è¿Ÿæ³¨è§£è¯„ä¼°

from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from langchain_core.runnables.config import RunnableConfig

class Runnable:
    def invoke(self, input: Any, config: "RunnableConfig" = None):
        # config å‚æ•°ä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹æ³¨è§£ï¼Œé¿å…å¾ªç¯å¯¼å…¥
        pass
```

---

## 4. ã€æœ€å°å¯ç”¨ã€‘

æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½å¼€å§‹è¿›è¡Œ LangChain æºç é˜…è¯»ï¼š

### 4.1 åˆ›å»ºå’Œå¯¼å…¥æ¨¡å—

```python
# åˆ›å»ºæ¨¡å—ï¼šmy_utils.py
def greet(name: str) -> str:
    return f"Hello, {name}!"

# ä½¿ç”¨æ¨¡å—ï¼šmain.py
from my_utils import greet
print(greet("World"))  # Hello, World!
```

### 4.2 åˆ›å»ºåŒ…å’Œ `__init__.py`

```python
# åˆ›å»ºåŒ…ç»“æ„
# my_package/
# â”œâ”€â”€ __init__.py
# â””â”€â”€ core.py

# my_package/core.py
class MyClass:
    pass

# my_package/__init__.py
from .core import MyClass
__all__ = ["MyClass"]

# ä½¿ç”¨åŒ…
from my_package import MyClass
```

### 4.3 ç†è§£ä¸¤ç§å¯¼å…¥æ–¹å¼

```python
# ç»å¯¹å¯¼å…¥ï¼ˆæ¨èï¼‰
from langchain_core.messages import HumanMessage

# ç›¸å¯¹å¯¼å…¥ï¼ˆåŒ…å†…éƒ¨ä½¿ç”¨ï¼‰
from .base import BaseMessage  # å½“å‰åŒ…çš„ base æ¨¡å—
from ..utils import helper     # çˆ¶åŒ…çš„ utils æ¨¡å—
```

### 4.4 ä½¿ç”¨ `if __name__ == "__main__"`

```python
# my_module.py
def main():
    print("ç›´æ¥è¿è¡Œæ­¤æ–‡ä»¶")

if __name__ == "__main__":
    main()

# ç›´æ¥è¿è¡Œï¼špython my_module.py â†’ æ‰§è¡Œ main()
# å¯¼å…¥ä½¿ç”¨ï¼šimport my_module â†’ ä¸æ‰§è¡Œ main()
```

**è¿™äº›çŸ¥è¯†è¶³ä»¥ï¼š**
- é˜…è¯» LangChain æºç çš„åŒ…ç»“æ„
- ç†è§£ `from langchain_core.xxx import YYY` çš„å«ä¹‰
- åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ç»„ç»‡ä»£ç 
- ç†è§£ä¸ºä»€ä¹ˆ LangChain çš„å¯¼å…¥è·¯å¾„æ˜¯é‚£æ ·è®¾è®¡çš„

---

## 5. ã€1ä¸ªç±»æ¯”ã€‘ï¼ˆåŒè½¨åˆ¶ï¼‰

### ç±»æ¯”1ï¼šæ¨¡å—ï¼ˆModuleï¼‰

#### ğŸ¨ å‰ç«¯è§†è§’ï¼šES Module / JavaScript æ–‡ä»¶

æ¨¡å—å°±åƒä¸€ä¸ª `.js` æˆ– `.ts` æ–‡ä»¶ï¼ŒåŒ…å«å¯¼å‡ºçš„å‡½æ•°ã€ç±»å’Œå˜é‡ã€‚

```javascript
// utils.js (JavaScript æ¨¡å—)
export const PI = 3.14159;

export function circleArea(radius) {
    return PI * radius ** 2;
}

export class Circle {
    constructor(radius) {
        this.radius = radius;
    }
}

// é»˜è®¤å¯¼å‡º
export default Circle;
```

```python
# utils.py (Python æ¨¡å—)
PI = 3.14159

def circle_area(radius):
    return PI * radius ** 2

class Circle:
    def __init__(self, radius):
        self.radius = radius
```

```javascript
// main.js - å¯¼å…¥æ–¹å¼
import { PI, circleArea } from './utils.js';      // å‘½åå¯¼å…¥
import Circle from './utils.js';                   // é»˜è®¤å¯¼å…¥
import * as utils from './utils.js';               // å…¨éƒ¨å¯¼å…¥
```

```python
# main.py - å¯¼å…¥æ–¹å¼
from utils import PI, circle_area   # å‘½åå¯¼å…¥
import utils                        # å…¨éƒ¨å¯¼å…¥
from utils import *                 # å…¨éƒ¨å¯¼å…¥ï¼ˆä¸æ¨èï¼‰
```

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šä¸€æœ¬ä¹¦

æ¨¡å—å°±åƒå›¾ä¹¦é¦†é‡Œçš„ä¸€æœ¬ä¹¦ï¼Œé‡Œé¢æœ‰å¾ˆå¤šçŸ¥è¯†ï¼ˆå‡½æ•°ã€ç±»ã€å˜é‡ï¼‰ã€‚

**ç”Ÿæ´»ä¾‹å­ï¼š**
```
æƒ³è±¡ä½ æœ‰ä¸€æœ¬ã€Šæ•°å­¦å…¬å¼å¤§å…¨ã€‹çš„ä¹¦ï¼š

ä¹¦é‡Œæœ‰ï¼š
- åœ†å‘¨ç‡ Ï€ = 3.14159ï¼ˆå˜é‡ï¼‰
- è®¡ç®—åœ†é¢ç§¯çš„æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰
- å„ç§å½¢çŠ¶çš„ä»‹ç»ï¼ˆç±»ï¼‰

å½“ä½ éœ€è¦è®¡ç®—åœ†é¢ç§¯æ—¶ï¼š
1. æ‰¾åˆ°è¿™æœ¬ä¹¦ï¼ˆimportï¼‰
2. ç¿»åˆ°"åœ†é¢ç§¯å…¬å¼"é‚£ä¸€é¡µï¼ˆfrom ... importï¼‰
3. æŒ‰ç…§å…¬å¼è®¡ç®—

ä½ ä¸éœ€è¦è‡ªå·±æ¨å¯¼å…¬å¼ï¼Œç›´æ¥ç”¨ä¹¦é‡Œå†™å¥½çš„å°±è¡Œï¼
```

---

### ç±»æ¯”2ï¼šåŒ…ï¼ˆPackageï¼‰

#### ğŸ¨ å‰ç«¯è§†è§’ï¼šnpm åŒ… / æ–‡ä»¶å¤¹ç»“æ„

åŒ…å°±åƒä¸€ä¸ª npm åŒ…æˆ–è€…é¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼Œ`__init__.py` ç±»ä¼¼äº `index.js` æˆ– `package.json`ã€‚

```
# npm åŒ…ç»“æ„
my-package/
â”œâ”€â”€ package.json      # ç±»ä¼¼ __init__.py
â”œâ”€â”€ index.js          # å…¥å£æ–‡ä»¶
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ helpers.js
â””â”€â”€ models/
    â”œâ”€â”€ index.js
    â””â”€â”€ user.js
```

```
# Python åŒ…ç»“æ„
my_package/
â”œâ”€â”€ __init__.py       # å…¥å£ï¼Œå®šä¹‰å…¬å¼€ API
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ helpers.py
â””â”€â”€ models/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ user.py
```

```javascript
// package.json å®šä¹‰å¯¼å‡º
{
  "main": "index.js",
  "exports": {
    ".": "./index.js",
    "./utils": "./utils/index.js"
  }
}
```

```python
# __init__.py å®šä¹‰å¯¼å‡º
from .utils import helper
from .models import User
__all__ = ["helper", "User"]
```

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šä¹¦æ¶

åŒ…å°±åƒå›¾ä¹¦é¦†çš„ä¸€ä¸ªä¹¦æ¶ï¼Œä¸Šé¢æ”¾ç€å¾ˆå¤šç›¸å…³çš„ä¹¦ï¼ˆæ¨¡å—ï¼‰ã€‚

**ç”Ÿæ´»ä¾‹å­ï¼š**
```
å›¾ä¹¦é¦†çš„"æ•°å­¦åŒº"ä¹¦æ¶ï¼ˆåŒ…ï¼‰ï¼š

æ•°å­¦åŒº/
â”œâ”€â”€ ç›®å½•æ¸…å•ï¼ˆ__init__.pyï¼‰  â† å‘Šè¯‰ä½ æœ‰å“ªäº›ä¹¦
â”œâ”€â”€ ã€ŠåŸºç¡€ç®—æœ¯ã€‹ï¼ˆmodule_a.pyï¼‰
â”œâ”€â”€ ã€Šå‡ ä½•å…¥é—¨ã€‹ï¼ˆmodule_b.pyï¼‰
â””â”€â”€ é«˜çº§æ•°å­¦/ï¼ˆå­åŒ…ï¼‰
    â”œâ”€â”€ ç›®å½•æ¸…å•ï¼ˆ__init__.pyï¼‰
    â”œâ”€â”€ ã€Šå¾®ç§¯åˆ†ã€‹
    â””â”€â”€ ã€Šçº¿æ€§ä»£æ•°ã€‹

å½“ä½ æƒ³å€Ÿä¹¦æ—¶ï¼š
- "æˆ‘è¦æ•°å­¦åŒºçš„ã€Šå‡ ä½•å…¥é—¨ã€‹" = from æ•°å­¦åŒº import å‡ ä½•å…¥é—¨
- "æˆ‘è¦æ•°å­¦åŒºé«˜çº§æ•°å­¦çš„ã€Šå¾®ç§¯åˆ†ã€‹" = from æ•°å­¦åŒº.é«˜çº§æ•°å­¦ import å¾®ç§¯åˆ†
```

---

### ç±»æ¯”3ï¼š`__init__.py`

#### ğŸ¨ å‰ç«¯è§†è§’ï¼šindex.js / barrel file

`__init__.py` ç±»ä¼¼äºå‰ç«¯çš„ `index.js`ï¼ˆbarrel æ–‡ä»¶ï¼‰ï¼Œç”¨äºé‡æ–°å¯¼å‡ºå’Œç®€åŒ–å¯¼å…¥è·¯å¾„ã€‚

```javascript
// components/index.js (barrel file)
export { Button } from './Button';
export { Input } from './Input';
export { Modal } from './Modal';

// ä½¿ç”¨
import { Button, Input } from './components';  // ç®€åŒ–å¯¼å…¥
```

```python
# components/__init__.py
from .button import Button
from .input import Input
from .modal import Modal

__all__ = ["Button", "Input", "Modal"]

# ä½¿ç”¨
from components import Button, Input  # ç®€åŒ–å¯¼å…¥
```

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šä¹¦æ¶çš„ç›®å½•æ¸…å•

`__init__.py` å°±åƒä¹¦æ¶å‰é¢è´´çš„ç›®å½•æ¸…å•ï¼Œå‘Šè¯‰ä½ è¿™ä¸ªä¹¦æ¶æœ‰ä»€ä¹ˆä¹¦ã€‚

**ç”Ÿæ´»ä¾‹å­ï¼š**
```
ä¹¦æ¶å‰é¢çš„ç›®å½•æ¸…å•ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ•°å­¦åŒº - ä¹¦ç›®æ¸…å•      â”‚
â”‚                         â”‚
â”‚ â˜… æ¨èé˜…è¯»ï¼š            â”‚
â”‚   Â· åŸºç¡€ç®—æœ¯            â”‚
â”‚   Â· å‡ ä½•å…¥é—¨            â”‚
â”‚                         â”‚
â”‚ å…¶ä»–ä¹¦ç±ï¼š              â”‚
â”‚   Â· ä¹ é¢˜é›†ï¼ˆå†…éƒ¨ç”¨ï¼‰     â”‚
â”‚   Â· æ•™å¸ˆæ‰‹å†Œï¼ˆä¸å¤–å€Ÿï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

"æ¨èé˜…è¯»" = __all__ï¼ˆå…¬å¼€çš„ï¼‰
"ä¸å¤–å€Ÿ" = ç§æœ‰çš„ï¼ˆ_å¼€å¤´ï¼‰
```

---

### ç±»æ¯”4ï¼šç›¸å¯¹å¯¼å…¥ vs ç»å¯¹å¯¼å…¥

#### ğŸ¨ å‰ç«¯è§†è§’ï¼šç›¸å¯¹è·¯å¾„ vs è·¯å¾„åˆ«å

```javascript
// ç›¸å¯¹å¯¼å…¥
import { helper } from './utils';        // å½“å‰ç›®å½•
import { Base } from '../base';          // ä¸Šçº§ç›®å½•

// ç»å¯¹å¯¼å…¥ï¼ˆä½¿ç”¨è·¯å¾„åˆ«åï¼‰
import { helper } from '@/utils';        // ä»é¡¹ç›®æ ¹ç›®å½•
import { Base } from '@components/base'; // ä½¿ç”¨åˆ«å
```

```python
# ç›¸å¯¹å¯¼å…¥
from . import utils           # å½“å‰åŒ…
from .. import base           # çˆ¶åŒ…

# ç»å¯¹å¯¼å…¥
from my_project.utils import helper     # å®Œæ•´è·¯å¾„
from langchain_core.messages import HumanMessage
```

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šæ‰¾ä¹¦çš„ä¸¤ç§æ–¹å¼

**ç”Ÿæ´»ä¾‹å­ï¼š**
```
ä½ åœ¨"æ•°å­¦åŒº-é«˜çº§æ•°å­¦"ä¹¦æ¶æ—è¾¹ï¼Œæƒ³æ‰¾ã€ŠåŸºç¡€ç®—æœ¯ã€‹ï¼š

æ–¹å¼1ï¼šç›¸å¯¹ä½ç½®ï¼ˆç›¸å¯¹å¯¼å…¥ï¼‰
"ä»è¿™ä¸ªä¹¦æ¶å¾€å‰èµ°ä¸€ä¸ªåŒºï¼ˆ..ï¼‰ï¼Œæ‰¾åŸºç¡€ç®—æœ¯"
from .. import åŸºç¡€ç®—æœ¯

æ–¹å¼2ï¼šå®Œæ•´åœ°å€ï¼ˆç»å¯¹å¯¼å…¥ï¼‰
"å»å›¾ä¹¦é¦†-3æ¥¼-æ•°å­¦åŒº-æ‰¾åŸºç¡€ç®—æœ¯"
from å›¾ä¹¦é¦†.3æ¥¼.æ•°å­¦åŒº import åŸºç¡€ç®—æœ¯

ç»å¯¹å¯¼å…¥æ›´æ¸…æ¥šï¼Œä½†å†™èµ·æ¥é•¿
ç›¸å¯¹å¯¼å…¥ç®€çŸ­ï¼Œä½†è¦çŸ¥é“è‡ªå·±åœ¨å“ª
```

---

### ç±»æ¯”5ï¼š`__all__`

#### ğŸ¨ å‰ç«¯è§†è§’ï¼šexports / public API

```javascript
// TypeScript: åªå¯¼å‡ºå…¬å¼€ API
// utils.ts
export function publicFunc() {}     // å…¬å¼€
function privateFunc() {}           // ç§æœ‰ï¼ˆä¸å¯¼å‡ºï¼‰

// package.json exports å­—æ®µ
{
  "exports": {
    ".": "./dist/index.js"  // åªæš´éœ²è¿™ä¸ªå…¥å£
  }
}
```

```python
# Python: ä½¿ç”¨ __all__ æ§åˆ¶å…¬å¼€ API
# utils.py
def public_func():
    pass

def _private_func():  # çº¦å®šï¼š_å¼€å¤´ä¸ºç§æœ‰
    pass

__all__ = ["public_func"]  # åªå…¬å¼€è¿™ä¸ª
```

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šå€Ÿé˜…æ¸…å•

**ç”Ÿæ´»ä¾‹å­ï¼š**
```
å›¾ä¹¦é¦†è§„å®šï¼š

å¯ä»¥å€Ÿé˜…çš„ä¹¦ï¼ˆ__all__ï¼‰ï¼š
âœ… æ•…äº‹ä¹¦
âœ… ç§‘æ™®ä¹¦
âœ… æ¼«ç”»ä¹¦

ä¸èƒ½å€Ÿé˜…çš„ä¹¦ï¼ˆç§æœ‰ï¼‰ï¼š
âŒ çè´µå¤ç±ï¼ˆå†…éƒ¨ç ”ç©¶ç”¨ï¼‰
âŒ æ•™å¸ˆå‚è€ƒä¹¦
âŒ ä¿®è¡¥ä¸­çš„ä¹¦

å½“ä½ è¯´"æˆ‘è¦å€Ÿä¹¦æ¶ä¸Šæ‰€æœ‰çš„ä¹¦"ï¼ˆimport *ï¼‰ï¼š
åªä¼šç»™ä½ "å¯ä»¥å€Ÿé˜…"æ¸…å•ä¸Šçš„ä¹¦ï¼
```

---

### ç±»æ¯”æ€»ç»“è¡¨

| Python æ¦‚å¿µ | å‰ç«¯ç±»æ¯” | å°æœ‹å‹ç±»æ¯” |
|------------|---------|-----------|
| æ¨¡å— (.py æ–‡ä»¶) | ES Module / .js æ–‡ä»¶ | ä¸€æœ¬ä¹¦ |
| åŒ… (æ–‡ä»¶å¤¹) | npm package / ç›®å½• | ä¹¦æ¶ |
| `__init__.py` | index.js / package.json | ä¹¦æ¶ç›®å½•æ¸…å• |
| `import` | import / require | å€Ÿä¹¦ |
| `from ... import` | å‘½åå¯¼å…¥ { x } | å€Ÿä¹¦ä¸­çš„æŸä¸ªç« èŠ‚ |
| `import *` | import * | å€Ÿæ•´ä¸ªä¹¦æ¶çš„ä¹¦ |
| `__all__` | exports / public API | å¯å€Ÿé˜…æ¸…å• |
| `_private` | ä¸å¯¼å‡ºçš„å‡½æ•° | ä¸å¤–å€Ÿçš„ä¹¦ |
| ç›¸å¯¹å¯¼å…¥ `from .` | `./relative/path` | ä»è¿™ä¸ªä¹¦æ¶æ‰¾ |
| ç»å¯¹å¯¼å…¥ | å®Œæ•´è·¯å¾„ / åˆ«å | ä»å›¾ä¹¦é¦†-åŒº-æ¶æ‰¾ |
| `sys.path` | NODE_PATH / è·¯å¾„è§£æ | å›¾ä¹¦é¦†æ¥¼å±‚åœ°å›¾ |
| å¾ªç¯å¯¼å…¥ | å¾ªç¯ä¾èµ– | Aä¹¦å¼•ç”¨Bä¹¦ï¼ŒBä¹¦å¼•ç”¨Aä¹¦ |

---

## 6. ã€åç›´è§‰ç‚¹ã€‘

### è¯¯åŒº1ï¼š`__init__.py` å¿…é¡»æ˜¯ç©ºçš„ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- `__init__.py` å¯ä»¥åŒ…å«ä»»æ„ä»£ç 
- å®ƒé€šå¸¸ç”¨äºï¼šé‡æ–°å¯¼å‡ºã€åˆå§‹åŒ–é€»è¾‘ã€å®šä¹‰åŒ…çº§åˆ«çš„å˜é‡
- ç©ºçš„ `__init__.py` åªæ˜¯æœ€ç®€å•çš„æƒ…å†µ

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
å¾ˆå¤šæ•™ç¨‹ä¸ºäº†ç®€åŒ–ï¼Œåªå±•ç¤ºç©ºçš„ `__init__.py`ï¼Œè®©äººä»¥ä¸ºå®ƒå¿…é¡»æ˜¯ç©ºçš„ã€‚å®é™…ä¸Šå®ƒæ˜¯ä¸€ä¸ªæ­£å¸¸çš„ Python æ–‡ä»¶ã€‚

**æ­£ç¡®ç†è§£ï¼š**

```python
# langchain_core/messages/__init__.py
# è¿™æ˜¯ä¸€ä¸ª"æ´»è·ƒ"çš„ __init__.py

"""LangChain æ¶ˆæ¯æ¨¡å—"""

# 1. é‡æ–°å¯¼å‡ºï¼ˆç®€åŒ–ç”¨æˆ·å¯¼å…¥è·¯å¾„ï¼‰
from langchain_core.messages.base import BaseMessage
from langchain_core.messages.human import HumanMessage
from langchain_core.messages.ai import AIMessage

# 2. å®šä¹‰åŒ…çº§åˆ«çš„å˜é‡
__version__ = "0.1.0"

# 3. å®šä¹‰å…¬å¼€ API
__all__ = ["BaseMessage", "HumanMessage", "AIMessage"]

# 4. åŒ…åˆå§‹åŒ–é€»è¾‘
def _setup():
    """åŒ…åŠ è½½æ—¶çš„åˆå§‹åŒ–"""
    pass

_setup()

# ç”¨æˆ·ç°åœ¨å¯ä»¥ï¼š
# from langchain_core.messages import HumanMessage
# è€Œä¸æ˜¯ï¼š
# from langchain_core.messages.human import HumanMessage
```

---

### è¯¯åŒº2ï¼šå¾ªç¯å¯¼å…¥æ— æ³•è§£å†³ï¼Œåªèƒ½é‡æ„ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- å¾ªç¯å¯¼å…¥æœ‰å¤šç§è§£å†³æ–¹æ¡ˆ
- å»¶è¿Ÿå¯¼å…¥æ˜¯æœ€ç®€å•çš„æ–¹æ³•
- `TYPE_CHECKING` å¯ä»¥è§£å†³ç±»å‹æ³¨è§£çš„å¾ªç¯å¯¼å…¥
- ä¸ä¸€å®šéœ€è¦é‡æ„æ•´ä¸ªä»£ç ç»“æ„

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
å¾ªç¯å¯¼å…¥é”™è¯¯ä¿¡æ¯ä¸å¤Ÿç›´è§‚ï¼Œå¾ˆå¤šäººç¬¬ä¸€æ¬¡é‡åˆ°å°±ç›´æ¥é‡æ„ï¼Œæ²¡æœ‰å°è¯•å…¶ä»–æ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚

**æ­£ç¡®ç†è§£ï¼š**

```python
# æ–¹æ¡ˆ1ï¼šå»¶è¿Ÿå¯¼å…¥ï¼ˆæœ€ç®€å•ï¼‰
# module_a.py
def function_a():
    from module_b import function_b  # åœ¨å‡½æ•°å†…å¯¼å…¥
    return function_b()

# æ–¹æ¡ˆ2ï¼šTYPE_CHECKINGï¼ˆç±»å‹æ³¨è§£ä¸“ç”¨ï¼‰
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from module_b import ClassB  # åªåœ¨ç±»å‹æ£€æŸ¥æ—¶å¯¼å…¥

class ClassA:
    def method(self, b: "ClassB"):  # å­—ç¬¦ä¸²æ³¨è§£
        pass

# æ–¹æ¡ˆ3ï¼šå¯¼å…¥æ¨¡å—è€Œä¸æ˜¯å…·ä½“åç§°
# ä¸è¦ï¼šfrom module_b import function_b
# è€Œæ˜¯ï¼šimport module_b
# ä½¿ç”¨ï¼šmodule_b.function_b()
```

---

### è¯¯åŒº3ï¼š`from module import *` ä¼šå¯¼å…¥æ¨¡å—ä¸­çš„æ‰€æœ‰å†…å®¹ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- å¦‚æœæ¨¡å—å®šä¹‰äº† `__all__`ï¼Œåªå¯¼å…¥ `__all__` ä¸­åˆ—å‡ºçš„åç§°
- å¦‚æœæ²¡æœ‰ `__all__`ï¼Œåªå¯¼å…¥ä¸ä»¥ `_` å¼€å¤´çš„åç§°
- æ‰€ä»¥ `import *` ä¸ä¼šå¯¼å…¥"æ‰€æœ‰"å†…å®¹

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
"*"åœ¨å…¶ä»–è¯­å¢ƒï¼ˆå¦‚æ­£åˆ™ã€é€šé…ç¬¦ï¼‰ç¡®å®è¡¨ç¤º"æ‰€æœ‰"ï¼Œå®¹æ˜“äº§ç”Ÿè¯¯è§£ã€‚

**æ­£ç¡®ç†è§£ï¼š**

```python
# my_module.py
public_var = "å…¬å¼€"
_private_var = "ç§æœ‰"

def public_func():
    pass

def _private_func():
    pass

__all__ = ["public_var"]  # åªå¯¼å‡ºè¿™ä¸€ä¸ª

# å¦ä¸€ä¸ªæ–‡ä»¶
from my_module import *

# å®é™…å¯¼å…¥çš„ï¼š
# - public_var  âœ…ï¼ˆåœ¨ __all__ ä¸­ï¼‰
# - _private_var  âŒï¼ˆä¸åœ¨ __all__ ä¸­ï¼‰
# - public_func  âŒï¼ˆä¸åœ¨ __all__ ä¸­ï¼‰
# - _private_func  âŒï¼ˆä¸åœ¨ __all__ ä¸­ä¸”ä»¥_å¼€å¤´ï¼‰

# å¦‚æœæ²¡æœ‰å®šä¹‰ __all__ï¼š
# - public_var  âœ…ï¼ˆä¸ä»¥_å¼€å¤´ï¼‰
# - _private_var  âŒï¼ˆä»¥_å¼€å¤´ï¼‰
# - public_func  âœ…ï¼ˆä¸ä»¥_å¼€å¤´ï¼‰
# - _private_func  âŒï¼ˆä»¥_å¼€å¤´ï¼‰
```

**æœ€ä½³å®è·µï¼š**

```python
# ä¸æ¨èï¼šfrom module import *
# æ¨èï¼šæ˜ç¡®å¯¼å…¥éœ€è¦çš„å†…å®¹
from langchain_core.messages import HumanMessage, AIMessage
```

---

## 7. ã€å®æˆ˜ä»£ç ã€‘

```python
"""
ç¤ºä¾‹ï¼šæ„å»º LangChain é£æ ¼çš„åŒ…ç»“æ„
æ¼”ç¤ºæ¨¡å—ä¸åŒ…ç³»ç»Ÿçš„æ ¸å¿ƒç”¨æ³•
"""

import sys
import os
from typing import TYPE_CHECKING, Any, Dict, List, Optional

# ===== 1. æ¨¡å—åŸºç¡€ =====
print("=== 1. æ¨¡å—åŸºç¡€ ===")

# åˆ›å»ºä¸€ä¸ªç®€å•æ¨¡å—ï¼ˆæ¨¡æ‹Ÿï¼‰
# å®é™…é¡¹ç›®ä¸­è¿™ä¼šæ˜¯å•ç‹¬çš„ .py æ–‡ä»¶

# æ¨¡æ‹Ÿ utils.py æ¨¡å—
class _UtilsModule:
    """æ¨¡æ‹Ÿä¸€ä¸ªå·¥å…·æ¨¡å—"""
    PI = 3.14159

    @staticmethod
    def format_message(content: str) -> str:
        return content.strip().lower()

utils = _UtilsModule()

print(f"PI = {utils.PI}")
print(f"format_message('  HELLO  ') = '{utils.format_message('  HELLO  ')}'")

# ===== 2. æ¨¡æ‹Ÿ LangChain åŒ…ç»“æ„ =====
print("\n=== 2. LangChain é£æ ¼çš„åŒ…ç»“æ„ ===")

# æ¨¡æ‹Ÿ langchain_core/messages/base.py
class BaseMessage:
    """æ¶ˆæ¯åŸºç±»"""
    content: str
    type: str = "base"

    def __init__(self, content: str):
        self.content = content

    def __repr__(self) -> str:
        return f"{self.__class__.__name__}(content='{self.content[:20]}...')"

# æ¨¡æ‹Ÿ langchain_core/messages/human.py
class HumanMessage(BaseMessage):
    """ç”¨æˆ·æ¶ˆæ¯"""
    type: str = "human"

# æ¨¡æ‹Ÿ langchain_core/messages/ai.py
class AIMessage(BaseMessage):
    """AI æ¶ˆæ¯"""
    type: str = "ai"

    def __init__(self, content: str, model: str = "gpt-4"):
        super().__init__(content)
        self.model = model

# æ¨¡æ‹Ÿ langchain_core/messages/__init__.py çš„æ•ˆæœ
# è¿™å°±æ˜¯ __init__.py åšçš„äº‹ï¼šé‡æ–°å¯¼å‡ºï¼Œå®šä¹‰ __all__
messages_module = {
    "BaseMessage": BaseMessage,
    "HumanMessage": HumanMessage,
    "AIMessage": AIMessage,
}
messages_all = ["BaseMessage", "HumanMessage", "AIMessage"]

print("messages åŒ…å¯¼å‡ºçš„ API:")
for name in messages_all:
    print(f"  - {name}")

# ===== 3. ä½¿ç”¨å¯¼å…¥çš„ç±» =====
print("\n=== 3. ä½¿ç”¨å¯¼å…¥çš„ç±» ===")

# æ¨¡æ‹Ÿ: from langchain_core.messages import HumanMessage, AIMessage
msg1 = HumanMessage("ä½ å¥½ï¼Œè¯·å¸®æˆ‘å†™ä¸€é¦–è¯—")
msg2 = AIMessage("å¥½çš„ï¼Œè¿™æ˜¯ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—...", model="gpt-4")

print(f"ç”¨æˆ·æ¶ˆæ¯: {msg1}")
print(f"AI æ¶ˆæ¯: {msg2}")
print(f"AI æ¶ˆæ¯æ¨¡å‹: {msg2.model}")

# ===== 4. æ¨¡æ‹Ÿ Runnable åŒ… =====
print("\n=== 4. Runnable é£æ ¼çš„ç»„ä»¶ ===")

from abc import ABC, abstractmethod

# æ¨¡æ‹Ÿ langchain_core/runnables/base.py
class Runnable(ABC):
    """å¯è¿è¡Œç»„ä»¶åŸºç±»"""

    @property
    def name(self) -> str:
        return self.__class__.__name__

    @abstractmethod
    def invoke(self, input: Any) -> Any:
        pass

    def __or__(self, other: "Runnable") -> "RunnableSequence":
        """é‡è½½ | æ“ä½œç¬¦"""
        return RunnableSequence(first=self, last=other)

# æ¨¡æ‹Ÿ langchain_core/runnables/sequence.py
class RunnableSequence(Runnable):
    """Runnable åºåˆ—"""

    def __init__(self, first: Runnable, last: Runnable):
        self.first = first
        self.last = last

    @property
    def name(self) -> str:
        return f"{self.first.name} | {self.last.name}"

    def invoke(self, input: Any) -> Any:
        return self.last.invoke(self.first.invoke(input))

# æ¨¡æ‹Ÿ langchain_core/runnables/passthrough.py
class RunnablePassthrough(Runnable):
    """ç›´é€š Runnable"""

    def invoke(self, input: Any) -> Any:
        return input

# æ¨¡æ‹Ÿ langchain_core/runnables/lambda_.py
class RunnableLambda(Runnable):
    """Lambda Runnable"""

    def __init__(self, func):
        self.func = func

    def invoke(self, input: Any) -> Any:
        return self.func(input)

# æ¨¡æ‹Ÿ langchain_core/runnables/__init__.py
runnables_all = [
    "Runnable",
    "RunnableSequence",
    "RunnablePassthrough",
    "RunnableLambda",
]

print("runnables åŒ…å¯¼å‡ºçš„ API:")
for name in runnables_all:
    print(f"  - {name}")

# ===== 5. LCEL ç®¡é“æ¼”ç¤º =====
print("\n=== 5. LCEL ç®¡é“æ¼”ç¤º ===")

# åˆ›å»ºç»„ä»¶
preprocessor = RunnableLambda(lambda x: x.strip().upper())
processor = RunnableLambda(lambda x: f"Processed: {x}")
postprocessor = RunnableLambda(lambda x: {"result": x, "length": len(x)})

# ä½¿ç”¨ | æ“ä½œç¬¦æ„å»ºç®¡é“
chain = preprocessor | processor | postprocessor

print(f"ç®¡é“åç§°: {chain.name}")
result = chain.invoke("  hello world  ")
print(f"è¾“å…¥: '  hello world  '")
print(f"è¾“å‡º: {result}")

# ===== 6. __all__ æ¼”ç¤º =====
print("\n=== 6. __all__ çš„ä½œç”¨ ===")

# æ¨¡æ‹Ÿä¸€ä¸ªæ¨¡å—çš„å†…å®¹
module_contents = {
    "public_func": "å…¬å¼€å‡½æ•°",
    "PublicClass": "å…¬å¼€ç±»",
    "_private_func": "ç§æœ‰å‡½æ•°",
    "_PrivateClass": "ç§æœ‰ç±»",
    "__internal": "å†…éƒ¨ä½¿ç”¨",
}

# å®šä¹‰ __all__
module_all = ["public_func", "PublicClass"]

print("æ¨¡å—å…¨éƒ¨å†…å®¹:")
for name, desc in module_contents.items():
    print(f"  - {name}: {desc}")

print("\n__all__ å¯¼å‡ºçš„å†…å®¹ (from module import * çš„æ•ˆæœ):")
for name in module_all:
    print(f"  - {name}")

print("\nä¸åœ¨ __all__ ä¸­çš„å†…å®¹:")
for name in module_contents:
    if name not in module_all:
        print(f"  - {name} (ä¸ä¼šè¢« import * å¯¼å…¥)")

# ===== 7. æ¨¡å—æœç´¢è·¯å¾„ =====
print("\n=== 7. æ¨¡å—æœç´¢è·¯å¾„ (sys.path) ===")

print("Python æœç´¢æ¨¡å—çš„è·¯å¾„é¡ºåº:")
for i, path in enumerate(sys.path[:5]):  # åªæ˜¾ç¤ºå‰5ä¸ª
    print(f"  {i+1}. {path}")
if len(sys.path) > 5:
    print(f"  ... è¿˜æœ‰ {len(sys.path) - 5} ä¸ªè·¯å¾„")

# ===== 8. TYPE_CHECKING é¿å…å¾ªç¯å¯¼å…¥ =====
print("\n=== 8. TYPE_CHECKING é¿å…å¾ªç¯å¯¼å…¥ ===")

# æ¼”ç¤º TYPE_CHECKING çš„ä½¿ç”¨
if TYPE_CHECKING:
    # è¿™éƒ¨åˆ†ä»£ç åªåœ¨ç±»å‹æ£€æŸ¥æ—¶æ‰§è¡Œ
    # è¿è¡Œæ—¶ä¸æ‰§è¡Œï¼Œé¿å…å¾ªç¯å¯¼å…¥
    from typing import Protocol

    class SupportsInvoke(Protocol):
        def invoke(self, input: Any) -> Any: ...

class MyComponent:
    """ä½¿ç”¨ TYPE_CHECKING çš„ç»„ä»¶"""

    def process(self, runnable: "Runnable") -> Any:
        # ç±»å‹æ³¨è§£ä½¿ç”¨å­—ç¬¦ä¸²å½¢å¼ï¼Œé¿å…è¿è¡Œæ—¶å¯¼å…¥
        return runnable.invoke("test")

print("TYPE_CHECKING çš„ä½œç”¨:")
print("  - ç±»å‹æ£€æŸ¥æ—¶ (mypy): TYPE_CHECKING = True")
print("  - è¿è¡Œæ—¶: TYPE_CHECKING = False")
print("  - ç”¨äºè§£å†³å¾ªç¯å¯¼å…¥é—®é¢˜")

# ===== 9. æ¨¡æ‹Ÿå®Œæ•´çš„ LangChain å¯¼å…¥ä½“éªŒ =====
print("\n=== 9. æ¨¡æ‹Ÿ LangChain å¯¼å…¥ä½“éªŒ ===")

# æ¨¡æ‹Ÿç”¨æˆ·ä½¿ç”¨ LangChain çš„æ–¹å¼
print("# ç”¨æˆ·ä»£ç ç¤ºä¾‹:")
print("from langchain_core.messages import HumanMessage, AIMessage")
print("from langchain_core.runnables import RunnableLambda, RunnableSequence")
print("")
print("# åˆ›å»ºæ¶ˆæ¯")
print("msg = HumanMessage('Hello!')")
print("")
print("# åˆ›å»ºå¤„ç†ç®¡é“")
print("chain = preprocess | llm | postprocess")
print("result = chain.invoke(input_data)")

# ===== 10. å®é™…æ¼”ç¤º =====
print("\n=== 10. ç»¼åˆæ¼”ç¤º ===")

# åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å¤„ç†æµç¨‹
messages = [
    HumanMessage("è¯·è§£é‡Šä»€ä¹ˆæ˜¯ LangChain"),
    AIMessage("LangChain æ˜¯ä¸€ä¸ªç”¨äºæ„å»º LLM åº”ç”¨çš„æ¡†æ¶...", model="gpt-4"),
    HumanMessage("èƒ½ç»™ä¸ªä»£ç ç¤ºä¾‹å—ï¼Ÿ"),
    AIMessage("å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š...", model="gpt-4"),
]

print("å¯¹è¯å†å²:")
for msg in messages:
    print(f"  [{msg.type}] {msg.content[:30]}...")

# åˆ›å»ºå¤„ç†ç®¡é“
def extract_content(messages):
    return [m.content for m in messages]

def count_words(contents):
    return {"contents": contents, "total_words": sum(len(c.split()) for c in contents)}

content_chain = RunnableLambda(extract_content) | RunnableLambda(count_words)

result = content_chain.invoke(messages)
print(f"\nå¤„ç†ç»“æœ: {result['total_words']} ä¸ªè¯")

print("\n=== å®Œæˆ ===")
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**

```
=== 1. æ¨¡å—åŸºç¡€ ===
PI = 3.14159
format_message('  HELLO  ') = 'hello'

=== 2. LangChain é£æ ¼çš„åŒ…ç»“æ„ ===
messages åŒ…å¯¼å‡ºçš„ API:
  - BaseMessage
  - HumanMessage
  - AIMessage

=== 3. ä½¿ç”¨å¯¼å…¥çš„ç±» ===
ç”¨æˆ·æ¶ˆæ¯: HumanMessage(content='ä½ å¥½ï¼Œè¯·å¸®æˆ‘å†™ä¸€é¦–è¯—...')
AI æ¶ˆæ¯: AIMessage(content='å¥½çš„ï¼Œè¿™æ˜¯ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—.....')
AI æ¶ˆæ¯æ¨¡å‹: gpt-4

=== 4. Runnable é£æ ¼çš„ç»„ä»¶ ===
runnables åŒ…å¯¼å‡ºçš„ API:
  - Runnable
  - RunnableSequence
  - RunnablePassthrough
  - RunnableLambda

=== 5. LCEL ç®¡é“æ¼”ç¤º ===
ç®¡é“åç§°: RunnableLambda | RunnableLambda | RunnableLambda
è¾“å…¥: '  hello world  '
è¾“å‡º: {'result': 'Processed: HELLO WORLD', 'length': 22}

=== 6. __all__ çš„ä½œç”¨ ===
æ¨¡å—å…¨éƒ¨å†…å®¹:
  - public_func: å…¬å¼€å‡½æ•°
  - PublicClass: å…¬å¼€ç±»
  - _private_func: ç§æœ‰å‡½æ•°
  - _PrivateClass: ç§æœ‰ç±»
  - __internal: å†…éƒ¨ä½¿ç”¨

__all__ å¯¼å‡ºçš„å†…å®¹ (from module import * çš„æ•ˆæœ):
  - public_func
  - PublicClass

ä¸åœ¨ __all__ ä¸­çš„å†…å®¹:
  - _private_func (ä¸ä¼šè¢« import * å¯¼å…¥)
  - _PrivateClass (ä¸ä¼šè¢« import * å¯¼å…¥)
  - __internal (ä¸ä¼šè¢« import * å¯¼å…¥)

=== 7. æ¨¡å—æœç´¢è·¯å¾„ (sys.path) ===
Python æœç´¢æ¨¡å—çš„è·¯å¾„é¡ºåº:
  1.
  2. /usr/lib/python3.10
  3. /usr/lib/python3.10/lib-dynload
  4. /usr/lib/python3.10/site-packages
  5. ...

=== 8. TYPE_CHECKING é¿å…å¾ªç¯å¯¼å…¥ ===
TYPE_CHECKING çš„ä½œç”¨:
  - ç±»å‹æ£€æŸ¥æ—¶ (mypy): TYPE_CHECKING = True
  - è¿è¡Œæ—¶: TYPE_CHECKING = False
  - ç”¨äºè§£å†³å¾ªç¯å¯¼å…¥é—®é¢˜

=== 9. æ¨¡æ‹Ÿ LangChain å¯¼å…¥ä½“éªŒ ===
# ç”¨æˆ·ä»£ç ç¤ºä¾‹:
from langchain_core.messages import HumanMessage, AIMessage
from langchain_core.runnables import RunnableLambda, RunnableSequence

# åˆ›å»ºæ¶ˆæ¯
msg = HumanMessage('Hello!')

# åˆ›å»ºå¤„ç†ç®¡é“
chain = preprocess | llm | postprocess
result = chain.invoke(input_data)

=== 10. ç»¼åˆæ¼”ç¤º ===
å¯¹è¯å†å²:
  [human] è¯·è§£é‡Šä»€ä¹ˆæ˜¯ LangChain...
  [ai] LangChain æ˜¯ä¸€ä¸ªç”¨äºæ„å»º LLM åº”ç”¨...
  [human] èƒ½ç»™ä¸ªä»£ç ç¤ºä¾‹å—ï¼Ÿ...
  [ai] å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š......

å¤„ç†ç»“æœ: 19 ä¸ªè¯

=== å®Œæˆ ===
```

---

## 8. ã€é¢è¯•å¿…é—®ã€‘

### é—®é¢˜ï¼š"Python çš„ç›¸å¯¹å¯¼å…¥å’Œç»å¯¹å¯¼å…¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ªï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"ç»å¯¹å¯¼å…¥ç”¨å®Œæ•´è·¯å¾„ï¼Œç›¸å¯¹å¯¼å…¥ç”¨ç‚¹å·ã€‚ä¸€èˆ¬æ¨èç»å¯¹å¯¼å…¥ã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **ç›¸å¯¹å¯¼å…¥å’Œç»å¯¹å¯¼å…¥æœ‰ä¸‰ä¸ªå…³é”®åŒºåˆ«ï¼š**
>
> 1. **è¯­æ³•å½¢å¼**ï¼š
>    - ç»å¯¹å¯¼å…¥ï¼š`from langchain_core.messages import HumanMessage`
>    - ç›¸å¯¹å¯¼å…¥ï¼š`from .base import BaseMessage` ï¼ˆåŒ…å†…éƒ¨ï¼‰
>
> 2. **ä½¿ç”¨åœºæ™¯**ï¼š
>    - ç»å¯¹å¯¼å…¥ï¼š**é¡¹ç›®ä»»ä½•åœ°æ–¹**éƒ½å¯ä»¥ç”¨ï¼Œè·¯å¾„æ¸…æ™°
>    - ç›¸å¯¹å¯¼å…¥ï¼š**åªèƒ½åœ¨åŒ…å†…éƒ¨**ä½¿ç”¨ï¼Œä¸èƒ½åœ¨é¡¶å±‚è„šæœ¬ç”¨
>
> 3. **å¯ç»´æŠ¤æ€§**ï¼š
>    - ç»å¯¹å¯¼å…¥ï¼šåŒ…é‡å‘½åéœ€è¦æ”¹æ‰€æœ‰å¯¼å…¥
>    - ç›¸å¯¹å¯¼å…¥ï¼šåŒ…å†…é‡æ„ä¸éœ€è¦æ”¹å¯¼å…¥ï¼ˆå› ä¸ºç”¨çš„ç›¸å¯¹è·¯å¾„ï¼‰
>
> **é€‰æ‹©åŸåˆ™**ï¼š
> - **åŒ…å†…éƒ¨æ¨¡å—äº’ç›¸å¼•ç”¨**ï¼šä¸¤ç§éƒ½è¡Œï¼ŒLangChain æºç ä¸¤ç§éƒ½ç”¨
> - **è·¨åŒ…å¯¼å…¥**ï¼šå¿…é¡»ç”¨ç»å¯¹å¯¼å…¥
> - **å¯¹å¤–å…¬å¼€çš„ç¤ºä¾‹ä»£ç **ï¼šç”¨ç»å¯¹å¯¼å…¥ï¼ˆæ›´æ¸…æ™°ï¼‰
>
> **LangChain æºç ä¸­çš„å®è·µ**ï¼š
> ```python
> # langchain_core/runnables/base.py
> # ç»å¯¹å¯¼å…¥ï¼ˆè·¨åŒ…ï¼‰
> from langchain_core.callbacks.manager import CallbackManager
>
> # ç›¸å¯¹å¯¼å…¥ï¼ˆåŒ…å†…ï¼‰
> from .config import RunnableConfig
> from .utils import Input, Output
> ```

**ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©ï¼Ÿ**
1. âœ… å¯¹æ¯”æ¸…æ™°ï¼ˆä¸‰ä¸ªåŒºåˆ«ï¼‰
2. âœ… ç»™å‡ºé€‰æ‹©åŸåˆ™
3. âœ… ç”¨ LangChain æºç ä¸¾ä¾‹
4. âœ… è¯´æ˜äº†å®é™…åœºæ™¯

---

### é—®é¢˜ï¼š"å¦‚ä½•è§£å†³ Python çš„å¾ªç¯å¯¼å…¥é—®é¢˜ï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"é‡æ„ä»£ç ï¼ŒæŠŠå…¬å…±éƒ¨åˆ†æå–å‡ºæ¥ã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **å¾ªç¯å¯¼å…¥æœ‰å››ç§è§£å†³æ–¹æ¡ˆï¼ŒæŒ‰å¤æ‚åº¦é€’å¢ï¼š**
>
> 1. **å»¶è¿Ÿå¯¼å…¥**ï¼ˆæœ€ç®€å•ï¼‰ï¼š
>    ```python
>    def my_function():
>        from other_module import SomeClass  # åœ¨å‡½æ•°å†…å¯¼å…¥
>        return SomeClass()
>    ```
>    ä¼˜ç‚¹ï¼šæ”¹åŠ¨æœ€å°ï¼›ç¼ºç‚¹ï¼šæ¯æ¬¡è°ƒç”¨éƒ½è¦å¯¼å…¥ï¼ˆæœ‰ç¼“å­˜ï¼Œæ€§èƒ½å½±å“å°ï¼‰
>
> 2. **å¯¼å…¥æ¨¡å—è€Œä¸æ˜¯å…·ä½“åç§°**ï¼š
>    ```python
>    import other_module  # è€Œä¸æ˜¯ from other_module import x
>
>    def my_function():
>        return other_module.SomeClass()
>    ```
>    ä¼˜ç‚¹ï¼šé¿å…å¯¼å…¥æ—¶çš„åç§°è§£æé—®é¢˜
>
> 3. **TYPE_CHECKING**ï¼ˆç±»å‹æ³¨è§£ä¸“ç”¨ï¼‰ï¼š
>    ```python
>    from typing import TYPE_CHECKING
>
>    if TYPE_CHECKING:
>        from other_module import SomeClass
>
>    def my_function(obj: "SomeClass"):  # å­—ç¬¦ä¸²æ³¨è§£
>        pass
>    ```
>    ä¼˜ç‚¹ï¼šç±»å‹æ£€æŸ¥æ­£å¸¸å·¥ä½œï¼Œè¿è¡Œæ—¶ä¸å¯¼å…¥
>
> 4. **é‡æ„ä»£ç ç»“æ„**ï¼ˆæ ¹æœ¬è§£å†³ï¼‰ï¼š
>    - æå–å…¬å…±ä¾èµ–åˆ°ç¬¬ä¸‰ä¸ªæ¨¡å—
>    - æ£€æŸ¥æ˜¯å¦æœ‰è®¾è®¡é—®é¢˜å¯¼è‡´å¾ªç¯ä¾èµ–
>
> **LangChain çš„å®è·µ**ï¼š
> ```python
> # langchain_core/runnables/base.py
> from __future__ import annotations  # å»¶è¿Ÿæ³¨è§£è¯„ä¼°
> from typing import TYPE_CHECKING
>
> if TYPE_CHECKING:
>     from langchain_core.runnables.config import RunnableConfig
> ```

---

## 9. ã€åŒ–éª¨ç»µæŒã€‘

### å¡ç‰‡1ï¼šä»€ä¹ˆæ˜¯æ¨¡å— ğŸ“„

**ä¸€å¥è¯ï¼š** æ¨¡å—å°±æ˜¯ä¸€ä¸ª `.py` æ–‡ä»¶ï¼ŒåŒ…å«å˜é‡ã€å‡½æ•°ã€ç±»ç­‰ Python ä»£ç ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# my_module.py å°±æ˜¯ä¸€ä¸ªæ¨¡å—
PI = 3.14
def circle_area(r): return PI * r ** 2
class Circle: pass
```

**åº”ç”¨ï¼š** LangChain çš„ `langchain_core/messages/base.py` å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå®šä¹‰äº† `BaseMessage` ç±»ã€‚

---

### å¡ç‰‡2ï¼šimport è¯­å¥ ğŸ“¥

**ä¸€å¥è¯ï¼š** `import` åŠ è½½æ¨¡å—ï¼Œè®©ä½ å¯ä»¥ä½¿ç”¨æ¨¡å—ä¸­çš„å†…å®¹ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# å¯¼å…¥æ•´ä¸ªæ¨¡å—
import math
print(math.pi)  # 3.14159...

# å¯¼å…¥å¹¶é‡å‘½å
import numpy as np
arr = np.array([1, 2, 3])
```

**åº”ç”¨ï¼š** `import langchain_core` åŠ è½½æ•´ä¸ª LangChain æ ¸å¿ƒåŒ…ã€‚

---

### å¡ç‰‡3ï¼šfrom...import è¯­æ³• ğŸ¯

**ä¸€å¥è¯ï¼š** `from...import` åªå¯¼å…¥æ¨¡å—ä¸­ç‰¹å®šçš„å†…å®¹ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# å¯¼å…¥ç‰¹å®šå†…å®¹
from math import pi, sqrt
print(pi)  # ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦ math.pi

# å¯¼å…¥å¹¶é‡å‘½å
from langchain_core.messages import HumanMessage as HM
msg = HM("Hello")
```

**åº”ç”¨ï¼š** LangChain æ¨èçš„å¯¼å…¥æ–¹å¼ï¼š`from langchain_core.messages import HumanMessage`

---

### å¡ç‰‡4ï¼šä»€ä¹ˆæ˜¯åŒ… ğŸ“

**ä¸€å¥è¯ï¼š** åŒ…æ˜¯ä¸€ä¸ªåŒ…å« `__init__.py` çš„æ–‡ä»¶å¤¹ï¼Œç”¨äºç»„ç»‡ç›¸å…³æ¨¡å—ã€‚

**ä¸¾ä¾‹ï¼š**
```
my_package/
â”œâ”€â”€ __init__.py      # å¿…é¡»æœ‰ï¼
â”œâ”€â”€ module_a.py
â””â”€â”€ module_b.py
```

**åº”ç”¨ï¼š** `langchain_core/messages/` æ˜¯ä¸€ä¸ªåŒ…ï¼ŒåŒ…å« `base.py`ã€`human.py`ã€`ai.py` ç­‰æ¨¡å—ã€‚

---

### å¡ç‰‡5ï¼š`__init__.py` çš„ä½œç”¨ ğŸšª

**ä¸€å¥è¯ï¼š** `__init__.py` æ ‡è¯†æ–‡ä»¶å¤¹æ˜¯åŒ…ï¼Œå¹¶æ§åˆ¶åŒ…çš„å¯¼å…¥è¡Œä¸ºã€‚

**ä¸¾ä¾‹ï¼š**
```python
# my_package/__init__.py
from .module_a import ClassA  # é‡æ–°å¯¼å‡º
from .module_b import func_b
__all__ = ["ClassA", "func_b"]  # å®šä¹‰å…¬å¼€ API
```

**åº”ç”¨ï¼š** LangChain ç”¨ `__init__.py` è®©ç”¨æˆ·å¯ä»¥ `from langchain_core.messages import HumanMessage` è€Œä¸éœ€è¦çŸ¥é“å…·ä½“æ–‡ä»¶ä½ç½®ã€‚

---

### å¡ç‰‡6ï¼šç›¸å¯¹å¯¼å…¥ vs ç»å¯¹å¯¼å…¥ ğŸ§­

**ä¸€å¥è¯ï¼š** ç»å¯¹å¯¼å…¥ç”¨å®Œæ•´è·¯å¾„ï¼Œç›¸å¯¹å¯¼å…¥ç”¨ `.` è¡¨ç¤ºå½“å‰/çˆ¶åŒ…ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# ç»å¯¹å¯¼å…¥
from langchain_core.messages import HumanMessage

# ç›¸å¯¹å¯¼å…¥ï¼ˆåœ¨åŒ…å†…éƒ¨ï¼‰
from . import base          # å½“å‰åŒ…
from ..utils import helper  # çˆ¶åŒ…çš„ utils
```

**åº”ç”¨ï¼š** LangChain æºç å†…éƒ¨å¸¸ç”¨ç›¸å¯¹å¯¼å…¥ï¼›ç”¨æˆ·ä»£ç ç”¨ç»å¯¹å¯¼å…¥ã€‚

---

### å¡ç‰‡7ï¼š`__all__` æ§åˆ¶å…¬å¼€ API ğŸ“‹

**ä¸€å¥è¯ï¼š** `__all__` åˆ—è¡¨å®šä¹‰ `from module import *` ä¼šå¯¼å…¥å“ªäº›åç§°ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# my_module.py
def public_func(): pass
def _private_func(): pass

__all__ = ["public_func"]  # åªæœ‰è¿™ä¸ªè¢« import * å¯¼å…¥
```

**åº”ç”¨ï¼š** LangChain æ¯ä¸ªåŒ…çš„ `__init__.py` éƒ½å®šä¹‰ `__all__` æ¥æ˜ç¡®å…¬å¼€ APIã€‚

---

### å¡ç‰‡8ï¼š`sys.path` å’Œæ¨¡å—æœç´¢ ğŸ”

**ä¸€å¥è¯ï¼š** Python æŒ‰ `sys.path` åˆ—è¡¨çš„é¡ºåºæœç´¢è¦å¯¼å…¥çš„æ¨¡å—ã€‚

**ä¸¾ä¾‹ï¼š**
```python
import sys
print(sys.path)  # ['', '/usr/lib/python3.10', ...]

# æ·»åŠ è‡ªå®šä¹‰è·¯å¾„
sys.path.insert(0, '/my/custom/path')
```

**åº”ç”¨ï¼š** å®‰è£…åŒ…æ—¶ï¼ŒåŒ…è¢«æ”¾åˆ° `site-packages`ï¼ˆåœ¨ `sys.path` ä¸­ï¼‰ï¼Œæ‰€ä»¥èƒ½è¢«å¯¼å…¥ã€‚

---

### å¡ç‰‡9ï¼šå¾ªç¯å¯¼å…¥ä¸è§£å†³æ–¹æ¡ˆ ğŸ”„

**ä¸€å¥è¯ï¼š** A å¯¼å…¥ Bï¼ŒB å¯¼å…¥ A ä¼šå¯¼è‡´å¾ªç¯å¯¼å…¥ï¼Œç”¨å»¶è¿Ÿå¯¼å…¥æˆ– `TYPE_CHECKING` è§£å†³ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# æ–¹æ¡ˆ1ï¼šå»¶è¿Ÿå¯¼å…¥
def my_func():
    from other import Something  # åœ¨å‡½æ•°å†…å¯¼å…¥

# æ–¹æ¡ˆ2ï¼šTYPE_CHECKING
from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from other import Something
```

**åº”ç”¨ï¼š** LangChain ä½¿ç”¨ `TYPE_CHECKING` å’Œå­—ç¬¦ä¸²æ³¨è§£é¿å…å¾ªç¯å¯¼å…¥ã€‚

---

### å¡ç‰‡10ï¼šLangChain æºç çš„åŒ…ç»“æ„ ğŸ—ï¸

**ä¸€å¥è¯ï¼š** LangChain ç”¨æ¸…æ™°çš„åŒ…ç»“æ„ç»„ç»‡ä»£ç ï¼Œæ¯ä¸ªåŠŸèƒ½ä¸€ä¸ªå­åŒ…ã€‚

**ä¸¾ä¾‹ï¼š**
```
langchain_core/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ messages/      # æ¶ˆæ¯ç›¸å…³
â”œâ”€â”€ runnables/     # Runnable ç»„ä»¶
â”œâ”€â”€ prompts/       # æç¤ºè¯æ¨¡æ¿
â”œâ”€â”€ output_parsers/  # è¾“å‡ºè§£æ
â””â”€â”€ language_models/ # è¯­è¨€æ¨¡å‹
```

**åº”ç”¨ï¼š** ç†è§£è¿™ä¸ªç»“æ„ï¼Œä½ å°±çŸ¥é“å»å“ªé‡Œæ‰¾ LangChain çš„æºç ï¼š
- çœ‹æ¶ˆæ¯å®ç°ï¼Ÿâ†’ `messages/`
- çœ‹ LCELï¼Ÿâ†’ `runnables/`
- çœ‹æç¤ºè¯ï¼Ÿâ†’ `prompts/`

---

## 10. ã€ä¸€å¥è¯æ€»ç»“ã€‘

**æ¨¡å—æ˜¯ `.py` æ–‡ä»¶ï¼ŒåŒ…æ˜¯å« `__init__.py` çš„æ–‡ä»¶å¤¹ï¼Œå®ƒä»¬é€šè¿‡å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´å®ç°ä»£ç å¤ç”¨ä¸å°è£…ï¼Œç†è§£æ¨¡å—ä¸åŒ…ç³»ç»Ÿæ˜¯é˜…è¯» LangChain æºç ç»“æ„ï¼ˆå¦‚ `from langchain_core.messages import HumanMessage`ï¼‰çš„åŸºç¡€ã€‚**

---

## ğŸ“š å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£æ¨¡å—æ˜¯ä»€ä¹ˆï¼ˆ`.py` æ–‡ä»¶ï¼‰
- [ ] ä¼šä½¿ç”¨ `import` å’Œ `from...import`
- [ ] ç†è§£ `__name__` å’Œ `if __name__ == "__main__"`
- [ ] ç†è§£åŒ…æ˜¯ä»€ä¹ˆï¼ˆå« `__init__.py` çš„æ–‡ä»¶å¤¹ï¼‰
- [ ] ä¼šåˆ›å»ºåŒ…å¹¶ç¼–å†™ `__init__.py`
- [ ] ç†è§£ç»å¯¹å¯¼å…¥å’Œç›¸å¯¹å¯¼å…¥çš„åŒºåˆ«
- [ ] ç†è§£ `__all__` çš„ä½œç”¨
- [ ] çŸ¥é“å¦‚ä½•è§£å†³å¾ªç¯å¯¼å…¥é—®é¢˜
- [ ] ç†è§£ `sys.path` å’Œæ¨¡å—æœç´¢æœºåˆ¶
- [ ] èƒ½å¤Ÿç†è§£ LangChain æºç çš„åŒ…ç»“æ„

## ğŸ”— ä¸‹ä¸€æ­¥å­¦ä¹ 

- **å¼‚å¸¸å¤„ç†æœºåˆ¶**ï¼šç†è§£ Python é”™è¯¯å¤„ç†å’Œè‡ªå®šä¹‰å¼‚å¸¸
- **Pydantic æ•°æ®éªŒè¯**ï¼šLangChain æ•°æ®æ¨¡å‹çš„åŸºç¡€
- **Runnable åè®®**ï¼šLangChain æ ¸å¿ƒçš„ç»„ä»¶æŠ½è±¡

---

**ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2025-12-12
